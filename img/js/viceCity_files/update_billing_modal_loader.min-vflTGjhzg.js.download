define(["require","exports","tslib","react","spectrum/button","classnames","modules/core/i18n","modules/constants/trademark","modules/clean/react/css","modules/clean/react/modal","modules/clean/payments/validation","modules/clean/teams/admin/types/constants","modules/clean/react/payments/unified_module/unified_payment_form_async","modules/clean/deprecated_ajax/ajax_jquery","modules/clean/react/payments/error/browser_update_required_modal","modules/core/notify","modules/clean/subscription/tools/amp_logger"],(function(e,t,a,o,n,r,s,i,l,d,u,c,m,p,f,g,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateBillingModalLoader=t.UpdateBillingModalLoaderView=void 0,o=a.__importDefault(o),r=a.__importDefault(r),p=a.__importStar(p);var b=(function(e){function l(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={submitting:!1,hasError:!1},t.handleLoadFailure=function(){g.Notify.error(s.intl.formatMessage({id:"C2BKnZ",defaultMessage:"Failed to load modal."})),t.modalLogger.logModalError("modal_init"),d.Modal.close(),t.props.onClose&&t.props.onClose()},t.logModalLoaded=function(){if(t.startTime){var e=Date.now()-t.startTime;t.modalLogger.logModalTTI(e)}},t.onAccept=function(){t.unifiedPaymentFormAsync&&t.unifiedPaymentFormAsync.onAccept()},t.onDismiss=function(){d.Modal.close(),t.props.onClose&&t.props.onClose()},t.onSuccess=function(){t.props.onSuccess&&t.props.onSuccess(),t.modalLogger.logModalSuccess()},t.onError=function(){t.modalLogger.logModalError("modal_submit")},t.saveUnifiedPaymentFormAsync=function(e){t.unifiedPaymentFormAsync=e},t.setSubmittingStatus=function(e){t.setState((function(t){return a.__assign(a.__assign({},t),{submitting:e})}))},t}return a.__extends(l,e),l.showInstance=function(e,a){d.Modal.showInstance(o.default.createElement(t.UpdateBillingModalLoader,{onClose:e,onSuccess:a}))},l.prototype.componentDidMount=function(){var e=this;this.startTime=Date.now(),this.modalLogger=y.getSubscriptionAMPLogger({ns:"team",modal:y.ModalTypes.UPDATE_BILLING_MODAL}),p.WebRequest({url:"/account/team/update_billing_modal_view_model",success:function(t){var a=JSON.parse(t);a.isError?a.errorType===c.TeamBillingErrorType.SUBSCRIPTION_EXPIRED?e.setState({hasError:!0,errorType:a.errorType}):a.errorType===c.TeamBillingErrorType.UNSUPPORTED_BROWSER?(e.handleLoadFailure(),f.BrowserUpdateModalLoader.showInstance()):e.handleLoadFailure():e.setState({hasError:!1,loadedProps:{countryCode:a.countryCode}},e.logModalLoaded)},error:function(){e.handleLoadFailure()}})},l.prototype.renderSubscriptionExpired=function(){return o.default.createElement("div",{className:"subscription-expired"},o.default.createElement("h3",{className:"subscription-expired--header"},s.intl.formatMessage({id:"JsiRXI",defaultMessage:"Your subscription has expired"})),o.default.createElement("div",{className:"subscription-expired--copy"},s.intl.formatMessage({id:"Ct4owd",defaultMessage:"To change your billing information, please first renew your {trademark_business} account. During the renewal process youâ€™ll be able to choose a different payment method."},{trademark_business:i.TRADEMARK_BUSINESS})))},l.prototype.renderSubscriptionExpiredButtons=function(){return o.default.createElement("div",{className:"subscription-expired--buttons"},o.default.createElement("a",{href:"/team/renew",className:"subscription-expired--button c-btn c-btn--primary"},s.intl.formatMessage({id:"q9bBTQ",defaultMessage:"Renew Your Account"})))},l.prototype.renderContent=function(){return o.default.createElement(m.UnifiedPaymentFormAsync,{isSubmittingStatus:this.setSubmittingStatus,onSuccess:this.onSuccess,ref:this.saveUnifiedPaymentFormAsync,isTeam:!0,onError:this.onError})},l.prototype.renderContentButtons=function(){var e=this.state,t=e.submitting,a=e.loadedProps,r=e.hasError,i=null;if(a){var l=a.countryCode,c=u.hasVat(l)?s.intl.formatMessage({id:"RCr4JC",defaultMessage:"Please note: changing your billing location or VAT number could impact your applicable tax rate."}):s.intl.formatMessage({id:"8vkOAo",defaultMessage:"Please note: changing your billing location could impact your applicable tax rate."});i=o.default.createElement("div",{className:"db-modal-lower-left-message"},c)}return o.default.createElement(d.ModalButtons,{className:"oq-modal__buttons"},i,o.default.createElement(n.Button,{className:"cancel-button",variant:"secondary",onClick:this.onDismiss},s.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"})),o.default.createElement(n.Button,{disabled:!a||t||r,variant:"primary",onClick:this.onAccept},s.intl.formatMessage({id:"F5NZs5",defaultMessage:"Save changes"})))},l.prototype.render=function(){var e,t=this.state,a=t.hasError,n=t.errorType,i=null;a&&n===c.TeamBillingErrorType.SUBSCRIPTION_EXPIRED?(e=this.renderSubscriptionExpired(),i=this.renderSubscriptionExpiredButtons()):(e=this.renderContent(),i=this.renderContentButtons());return o.default.createElement(d.Modal,{className:r.default(["update-billing-modal","update-billing-modal-maestro"]),autoClose:!1,buttonComponent:i,title:a?null:s.intl.formatMessage({id:"yO4V6k",defaultMessage:"Update billing information"}),onDismiss:this.props.onClose},o.default.createElement("div",{className:"dynamic-content"},e))},l})(o.default.Component);t.UpdateBillingModalLoaderView=b,t.UpdateBillingModalLoader=l.requireCssWithComponent(b,["/static/css/teams/admin/widgets/update_billing_modal/update_billing_modal-vflIeFbeJ.css"])}));
//# sourceMappingURL=update_billing_modal_loader.min.js-vflJvxTNs.map