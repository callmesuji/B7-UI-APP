define(["require","exports","tslib","react","modules/core/i18n","spectrum/button","spectrum/modal","spectrum/input","modules/clean/teams/admin/widgets/import_contacts_modal/contact_row","dig-components/typography","modules/clean/react/css","modules/clean/api_v2/user_client","modules/clean/viewer","dig-components/progress_indicators","modules/clean/profile_services/profile_services_constants","modules/clean/contacts/contact","modules/clean/analytics","react-intl","modules/clean/react/modal","react-window"],(function(e,t,a,n,o,l,s,i,r,c,d,m,u,f,_,g,p,v,h,M){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImportContactsModal=t.millisecondLoadingMessageDelay=void 0,n=a.__importStar(n),_=a.__importDefault(_);var y=o.intl.formatMessage({id:"LmN8eC",defaultMessage:"Search Google contacts"}),E=o.intl.formatMessage({id:"qx0cgi",defaultMessage:"Back"}),b=o.intl.formatMessage({id:"I+vIeJ",defaultMessage:"Select all"}),N=o.intl.formatMessage({id:"+t/Zhg",defaultMessage:"Deselect all"}),w=o.intl.formatMessage({id:"WElJu0",defaultMessage:"Search"}),S=v.defineMessage({id:"/c7TiD",defaultMessage:"{count, plural, one{# contact} other{# contacts}}"}),C=o.intl.formatMessage({id:"uB0ll+",defaultMessage:"Continue"}),x=o.intl.formatMessage({id:"yofFQe",defaultMessage:"Loading imported contacts…"}),L=o.intl.formatMessage({id:"uJxOXX",defaultMessage:"We couldn't find that person"}),T=o.intl.formatMessage({id:"1l7IZN",defaultMessage:"We couldn't find any organization contacts in your Google Directory"}),k=o.intl.formatMessage({id:"b+266D",defaultMessage:"Something went wrong, but we think it’s a fluke."}),G=o.intl.formatMessage({id:"7YQq8z",defaultMessage:"Try reloading the page."}),A=o.intl.formatMessage({id:"zuKf/F",defaultMessage:"We weren’t able to retrieve your organization’s directory from Google"}),D=o.intl.formatMessage({id:"OXjubu",defaultMessage:"The Google Directory integration is turned off."}),I=o.intl.formatMessage({id:"RFM0Ul",defaultMessage:"Manage app settings"}),W=o.intl.formatMessage({id:"+mJra0",defaultMessage:"This may take a few more seconds"});t.millisecondLoadingMessageDelay=3e3;var z;(function(e){e[e.None=0]="None",e[e.GoogleConnection=1]="GoogleConnection",e[e.Generic=2]="Generic"})(z||(z={}));t.ImportContactsModal=d.requireCssWithComponent((function(e){var d=n.useState(!0),v=d[0],F=d[1],O=n.useState(!1),U=O[0],q=O[1],B=n.useState(z.None),R=B[0],J=B[1],j=n.useState(""),X=j[0],P=j[1],Q=n.useState([]),V=Q[0],Z=Q[1],K=n.useState([]),Y=K[0],H=K[1],$=n.useState([]),ee=$[0],te=$[1],ae=n.useState(new Map),ne=ae[0],oe=ae[1],le=(function(e,t){var a=n.useState(e),o=a[0],l=a[1];return n.useEffect((function(){var a=setTimeout((function(){l(e)}),t);return function(){clearTimeout(a)}}),[e,t]),o})(X,300);n.useEffect((function(){p.TeamsWebActionsLogger.log("google_directory_import_modal_shown"),e.isDisabled?p.TeamsWebActionsLogger.log("google_directory_import_modal_disabled_state"):(be(),setTimeout((function(){return q(v)}),t.millisecondLoadingMessageDelay))}),[]),n.useEffect((function(){R===z.None&&ye(le)}),[le,v,R]);var se=a.__spreadArrays(V,Y),ie=se.map((function(e){return e.email})),re=ee.sort((function(e,t){return e.displayName.localeCompare(t.displayName)})),ce=re.filter((function(e){return r.isInvitable(e)})),de=ce.filter((function(e){return e.isSelected})),me=e.preselectedContacts.map((function(e){return e.email})),ue=V.filter((function(e){return e.isSelected})),fe=de.length===ce.length,_e=0===se.length,ge=!_e&&0===ee.length&&le,pe=function(){var t=ue.map((function(e){return g.Contact.buildFromRawEmail(e.email)})),a=e.preselectedContacts.filter((function(e){return e.email&&!ie.includes(e.email)}));e.onConfirmSelection(t,a)},ve=n.useMemo((function(){return n.default.createElement(l.Button,{className:"import-contacts-modal__confirm-select",variant:"primary",disabled:v||0===ue.length,onClick:pe},n.default.createElement("span",{className:"modal-button-wrapper"},C))}),[ue,v]),he=function(t){e.onClose()},Me=n.useMemo((function(){return n.default.createElement(l.Button,{className:"import-contacts-modal__go-back",variant:"secondary",onClick:he},n.default.createElement("span",{className:"modal-button-wrapper"},E))}),[]),ye=function(e){if(e){for(var t=e.toLocaleLowerCase(),a=[],n=0,o=Array.from(ne.keys());n<o.length;n++){var l=o[n];l.includes(t)&&a.push(ne.get(l))}te(a)}else te(se)},Ee=function(e){var t=e.isSelected?"google_directory_import_modal_deselect_contact":"google_directory_import_modal_select_contact";p.TeamsWebActionsLogger.log(t),Z((function(t){var n=a.__spreadArrays(t);return n.includes(e)&&(e.isSelected=!e.isSelected),n}))},be=function(){return a.__awaiter(void 0,void 0,void 0,(function(){var e,t,n,o,l,s,i,c,d;return a.__generator(this,(function(a){switch(a.label){case 0:e=u.Viewer.get_viewer(),t=(new m.UserApiV2Client).ns("domain_contacts"),n={contacts:[]},a.label=1;case 1:return a.trys.push([1,3,,4]),[4,t.rpc("list",{service:_.default.to_api_service_type(_.default.GOOGLE)},{subjectUserId:e.work_user.id})];case 2:return n=a.sent(),[3,4];case 3:return o=a.sent(),J((null===(d=null==o?void 0:o.raw)||void 0===d?void 0:d.responseBody.includes("InvalidServiceResponseException"))?z.GoogleConnection:z.Generic),F(!1),p.TeamsWebActionsLogger.log("google_directory_import_modal_error_state"),[2];case 4:return l=n.contacts.filter((function(t){return t.email!==e.work_user.email})).map((function(e){return{email:e.email,displayName:e.display_name,teamStatus:e.team_status,isSelected:!1}})),s=l.filter((function(e){return r.isInvitable(e)})),i=l.filter((function(e){return!r.isInvitable(e)})),s.forEach((function(e){e.isSelected=-1!==me.indexOf(e.email)})),i.forEach((function(e){e.isSelected=!0})),c=new Map,l.forEach((function(e){var t=(e.displayName+" "+e.email).toLocaleLowerCase();c.set(t,e)})),Z(s),H(i),oe(c),p.TeamsWebActionsLogger.log("google_directory_import_modal_contacts_loaded",{num_invitable_contacts:s.length,num_uninvitable_contacts:i.length}),F(!1),[2]}}))}))},Ne={tagName:"p",color:"faint",size:"small"};return n.default.createElement(s.UtilityModal,{title:y,open:!0,ariaLabel:y,primaryAction:function(){return ve},secondaryAction:function(){return Me},className:"import-contacts-modal",width:e.width+"px",onRequestClose:h.Modal.close},n.default.createElement(n.default.Fragment,null,n.default.createElement(i.Input,{className:"import-contacts-modal__search",placeholder:w,value:X,"aria-label":w,fullWidth:!0,onChange:function(e){return P(e.target.value)}}),e.isDisabled?n.default.createElement("div",{className:"import-contacts-modal__container"},n.default.createElement(c.Text,a.__assign({},Ne,{className:"import-contacts-modal__centered-text"}),D," ",n.default.createElement("br",null),n.default.createElement(c.Link,{href:"/team/admin/settings/app_actions",hasNoUnderline:!0},I))):v?n.default.createElement("div",{className:"import-contacts-modal__container"},n.default.createElement(f.Spinner,{"aria-valuetext":x}),n.default.createElement(c.Text,a.__assign({},Ne,{className:U?"import-contacts-modal__centered-text":"import-contacts-modal__hidden-text"}),W)):R===z.Generic?n.default.createElement("div",{className:"import-contacts-modal__container"},n.default.createElement(c.Text,a.__assign({},Ne,{className:"import-contacts-modal__centered-text"}),k," ",n.default.createElement("br",null)," ",G)):R===z.GoogleConnection?n.default.createElement("div",{className:"import-contacts-modal__container"},n.default.createElement(c.Text,a.__assign({},Ne,{className:"import-contacts-modal__centered-text"}),A)):_e?n.default.createElement("div",{className:"import-contacts-modal__container"},n.default.createElement(c.Text,a.__assign({},Ne),T)):ge?n.default.createElement("div",{className:"import-contacts-modal__container"},n.default.createElement(c.Text,a.__assign({},Ne,{className:"import-contacts-modal__centered-text"}),L)):n.default.createElement(n.default.Fragment,null,n.default.createElement("div",{className:"import-contacts-modal__select-controls"},n.default.createElement("div",{className:"import-contacts-modal__num-selected"},o.intl.formatMessage(S,{count:ue.length})),ce.length>0&&n.default.createElement(c.Link,{href:"",onClick:function(e){e.preventDefault(),e.stopPropagation();var t=fe?de.length:ce.length-de.length,n=fe?"google_directory_import_modal_deselect_all":"google_directory_import_modal_select_all";p.TeamsWebActionsLogger.log(n,{num_contacts_toggled:t,total_invitable_contacts:V.length,search_term_present:""!==X}),te((function(e){return(function(e,t){var n=a.__spreadArrays(e);return n.forEach((function(e){r.isInvitable(e)&&(e.isSelected=!t)})),n})(e,fe)}))},hasNoUnderline:!0,className:"import-contacts-modal__"+(fe?"deselect-all":"select-all")},fe?N:b)),n.default.createElement("hr",{className:"import-contacts-modal__divider"}),n.default.createElement("div",{className:"import-contacts-modal__contacts"},n.default.createElement(M.FixedSizeList,{height:215,width:e.width-48,itemCount:ee.length,itemSize:48},(function(e){return n.default.createElement("div",{style:e.style},n.default.createElement(r.ContactRow,{key:re[e.index].email,contact:re[e.index],onCheck:Ee}))}))))))}),["/static/css/teams/admin/widgets/import_contacts_modal/import_contacts_modal-vflw7c8Ds.css"])}));
//# sourceMappingURL=import_contacts_modal.min.js-vflt3i2G9.map