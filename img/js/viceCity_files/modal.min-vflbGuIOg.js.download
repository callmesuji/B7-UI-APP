define(["require","exports","tslib","react","classnames","lodash","modules/clean/analytics","modules/clean/auth/login/form","modules/clean/auth/login_or_register/types","modules/clean/auth/register/form","modules/clean/auth/register/types","modules/clean/auth_event_logger","modules/clean/growth/experiments/logger","modules/clean/react/comments2/data/logger","modules/clean/react/css","modules/clean/react/modal","modules/clean/react/welcome_modal","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","spectrum/button","spectrum/modal","modules/clean/auth/common/stats","modules/clean/react/maestro_nav/shared_code/dropbox_logo","modules/clean/react/file_viewer/conversions/conversion_utils","react-intl"],(function(e,t,o,a,s,n,i,r,l,d,c,u,m,g,p,f,M,h,_,v,O,S,E,L,T,y,C){"use strict";var R;Object.defineProperty(t,"__esModule",{value:!0}),t.LoginOrRegisterModal=t.TestOnlyLoginOrRegisterModal=t.TestOnlyCommentsHeader=t.TestOnlyCommentTextVariantCssClass=t.ExperimentalToggleMessage=t.DefaultHeaderContent=void 0,a=o.__importDefault(a),s=o.__importDefault(s),m=o.__importDefault(m),g=o.__importStar(g),h=o.__importStar(h);var b=((R={})[l.CommentTextVariant.DEFAULT]="default-variant",R[l.CommentTextVariant.POST]="post-comment-variant",R[l.CommentTextVariant.SUBSCRIBE]="subscribe-variant",R);t.TestOnlyCommentTextVariantCssClass=b,t.DefaultHeaderContent=function(e){var t=e.mode;return a.default.createElement("div",{className:"modal-header"},a.default.createElement(T.DropboxLogo,{className:"modal-header__dropbox-logo"}),a.default.createElement("span",null,v.intl.formatMessage(t===l.Mode.LOGIN?C.defineMessage({id:"nOuyMw",defaultMessage:"Save it for later in your Dropbox account"}):C.defineMessage({id:"eUpi8/",defaultMessage:"Save it for later in Dropbox"}))))},t.ExperimentalToggleMessage=function(e){var t=e.mode,o=e.onHeaderLinkClick,s=t===l.Mode.LOGIN?C.defineMessage({id:"vHTAAQ",defaultMessage:"Sign in or <a>create an account</a>"}):C.defineMessage({id:"+OG7LA",defaultMessage:"Sign up or <a>sign in to your account</a>"});return a.default.createElement(a.default.Fragment,null,v.intl.formatMessage(s,{a:function(e){return a.default.createElement(S.Button,{className:"button-as-link toggle-form-link",onClick:o,variant:"styleless"},e)}}))};var w=function(e){var t,o=e.className,s=e.commentTextVariant,n=e.mode;switch(s){case l.CommentTextVariant.POST:t=n===l.Mode.LOGIN?v.intl.formatMessage({id:"KXgMVH",defaultMessage:"To post your comment, sign in to Dropbox."}):v.intl.formatMessage({id:"LakyAx",defaultMessage:"To post your comment, create a free Dropbox account."});break;case l.CommentTextVariant.SUBSCRIBE:t=n===l.Mode.LOGIN?v.intl.formatMessage({id:"oHZbXS",defaultMessage:"To subscribe to this file, sign in to Dropbox."}):v.intl.formatMessage({id:"fy/9XT",defaultMessage:"To subscribe to this file, create a free Dropbox account."});break;default:t=n===l.Mode.LOGIN?v.intl.formatMessage({id:"3qW+D4",defaultMessage:"To continue, sign in to Dropbox."}):v.intl.formatMessage({id:"uMjLqH",defaultMessage:"To continue, create a free Dropbox account."})}return a.default.createElement("div",{className:"text-variant "+o},t)};t.TestOnlyCommentsHeader=w;var D=(function(e){function p(o){var s=e.call(this,o)||this;return s.logWebActivityOnce=n.once((function(e){i.WebMiscActivityLogger.log(e,{auth_google:!0})})),s.logAuthIntent=function(){s.state.mode===l.Mode.LOGIN?u.AuthEventLogger.log_web_login_intent():u.AuthEventLogger.log_web_signup_intent()},s.renderHeader=function(){if(s.state.isThirdPartyRegistrationContinuation)return a.default.createElement("div",{className:"mc-util-modal-header center"},a.default.createElement("h1",null,v.intl.formatMessage({id:"Ft3ikL",defaultMessage:"Create account and continue"})));var e=s.props,o=e.commentParams,n=e.customHeaderContent,i=e.kind;if(n){var r=n;return a.default.createElement(r,{mode:s.state.mode,changeMode:s.toggleMode})}return a.default.createElement("div",{className:"mc-util-modal-header center"},i===l.LoginOrRegisterKind.COMMENT?a.default.createElement(w,{className:b[o.variant],commentTextVariant:o.variant,mode:s.state.mode}):a.default.createElement(t.DefaultHeaderContent,{mode:s.state.mode}))},s.renderFooter=function(){var e=s.props.customFooterContent;if(e){var t=e;return a.default.createElement(t,null)}return null},s.toggleMode=function(e){e.preventDefault(),s.setState((function(e){if(s.props.kind===l.LoginOrRegisterKind.COMMENT){var t=e.mode===l.Mode.LOGIN?"sign_up_modal_toggle_to_sign_up":"sign_up_modal_toggle_to_sign_in";g.logEvent(t,{stream:s.props.commentParams.stream})}return{mode:e.mode===l.Mode.LOGIN?l.Mode.REGISTER:l.Mode.LOGIN}}),s.logAuthIntent)},s.onAuthenticateSuccess=function(e,t){var o=s.state.mode,n=s.props,i=n.downloadAction,r=n.kind;if(o===l.Mode.LOGIN?O.Notify.success(v.intl.formatMessage({id:"Ye/4Vz",defaultMessage:"Successfully signed in to Dropbox"})):O.Notify.success(v.intl.formatMessage({id:"4wqmq+",defaultMessage:"Successfully signed up for Dropbox"})),s.props.kind===l.LoginOrRegisterKind.COMMENT){var d=o===l.Mode.LOGIN?"sign_up_modal_sign_in_success":"sign_up_modal_sign_up_success";g.logEvent(d,{stream:s.props.commentParams.stream})}var c=t&&s.shouldRedirectToTeamDiscoveryPage(t);if(c)return h.redirect(c);if(s.props.onAuthenticateSuccess&&s.props.onAuthenticateSuccess(e),r===l.LoginOrRegisterKind.IMMEDIATE||r===l.LoginOrRegisterKind.SIDEBAR||i===l.DownloadAction.DIRECT_DOWNLOAD)if(o===l.Mode.REGISTER){if(t&&t.force_redirect_url&&t.redirect_url)return h.redirect(t.redirect_url);m.default.log("sharing","shared_link_welcome_modal_view"),f.Modal.showInstance(a.default.createElement(M.WelcomeModal,{id:"shared-link-welcome-modal"}))}else o===l.Mode.LOGIN&&h.reload();else s.closeModal()},s.logLoginOrRegisterModalDismissed=function(){var e=s.props.kind;s.state.mode===l.Mode.REGISTER?L.AuthUXAnalyticsLogger.logSignupModalDismissed(e||void 0):L.AuthUXAnalyticsLogger.logLoginModalDismissed(e||void 0)},s.onCancel=function(e){e&&e.stopPropagation(),s.logLoginOrRegisterModalDismissed(),s.props.onCancel(),s.closeModal()},s.closeModal=function(e){e&&e.stopPropagation(),f.Modal.close()},s.state={mode:o.initialMode||l.Mode.LOGIN,isThirdPartyRegistrationContinuation:!1},_.assert(!(o.kind===l.LoginOrRegisterKind.COMMENT&&!o.commentParams),"Comment parameters must be provided if calling this modal from comments code"),s}return o.__extends(p,e),p.prototype.componentDidMount=function(){var e=this.props,t=e.downloadAction,o=e.kind,a=e.initialMode;this.logAuthIntent(),o===l.LoginOrRegisterKind.IMMEDIATE?this.logWebActivityOnce("signup_modal-show-upfront"):o===l.LoginOrRegisterKind.DOWNLOAD&&t===l.DownloadAction.DIRECT_DOWNLOAD&&this.logWebActivityOnce("signup_modal-show-download"),a===l.Mode.LOGIN?L.AuthUXAnalyticsLogger.logLoginModalShown(o||void 0):L.AuthUXAnalyticsLogger.logSignupModalShown(o||void 0)},p.prototype.render=function(){var e=this,n=this.state.mode,i=this.props,u=i.id,m=i.signup_tag,g=i.showGoogleRegistration,p=i.googleRegisterProps,f=i.customHeaderContent,M=i.customFooterContent,h=i.loginContinuationUrl;return a.default.createElement(E.Modal,{ariaLabel:"Login or register modal",appElement:document.body,bodyId:u,className:s.default("mc-util-modal mc-util-modal-regular login-or-register-modal",{"conversion-experiment":y.shouldShowSimplifiedModal()}),displayCloseButton:!0,onRequestClose:this.onCancel,open:!0,overlayClassName:"file-viewer-modal-overlay",width:y.shouldShowSimplifiedModal()?400:500},this.renderHeader(),a.default.createElement("div",{className:"mc-util-modal-body"},y.shouldShowSimplifiedModal()&&!f&&a.default.createElement(t.ExperimentalToggleMessage,{mode:this.state.mode,onHeaderLinkClick:this.toggleMode}),n===l.Mode.LOGIN&&a.default.createElement(r.LoginForm,{canRedirect:!1,continuationUrl:h,className:"login-form-wrapper",googleLoginProps:y.shouldShowSimplifiedModal()?{positionBelow:!0}:{positionBelow:!1},appleLoginProps:y.shouldShowSimplifiedModal()?{positionBelow:!0}:{positionBelow:!1},maestroStyle:!y.shouldShowSimplifiedModal(),onLoginSuccess:this.onAuthenticateSuccess,rememberMeCheckboxProps:{checked:!0},encryptionOptions:this.props.encryptionOptions}),n===l.Mode.REGISTER&&a.default.createElement(d.RegisterForm,{additionalParams:m?{signup_tag:m}:void 0,canRedirect:!1,className:"register-form-wrapper",maestroStyle:!y.shouldShowSimplifiedModal(),onRegisterSuccess:this.onAuthenticateSuccess,tosCheckboxProps:{inline:!1},googleRegisterProps:g?o.__assign(o.__assign({},p||{}),{position:"BOTTOM"}):void 0,onRegisterFormEvent:function(t){t===c.RegisterFormEvent.GOOGLE_REGISTER_SUCCESS&&e.setState({isThirdPartyRegistrationContinuation:!0})},showSplitSignupFlow:y.shouldShowSplitSignup()})),M&&this.renderFooter())},p.prototype.shouldRedirectToTeamDiscoveryPage=function(e){var t=this.state.mode;if(this.props.kind===l.LoginOrRegisterKind.SIDEBAR&&t===l.Mode.REGISTER&&e.force_redirect_url&&e.redirect_url&&e.redirect_url.indexOf("/team/discover/suggest")>-1)return e.redirect_url},p.defaultProps={showGoogleRegistration:!0},p})(a.default.PureComponent);t.TestOnlyLoginOrRegisterModal=D;var A=p.requireCssWithComponent(D,["/static/css/components/login_or_register_modal-vflN9bxi9.css","/static/css/legacy_packages/components-vflhqG2jM.css","/static/css/components/button-vfllw60O5.css","/static/css/scooter/scooter-scoped-vfl5wRSGl.css","/static/css/recaptcha_challenge-vflrcf67y.css","/static/css/recaptcha_v2_challenge-vfl5GXpO2.css"]);t.LoginOrRegisterModal=A}));
//# sourceMappingURL=modal.min.js-vflPU10uq.map