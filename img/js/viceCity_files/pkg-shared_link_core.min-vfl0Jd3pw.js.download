define("modules/clean/react/file_viewer/ml_experiment",["require","exports","modules/clean/api_v2/user_client"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchDocClassification=t.ML_EXPERIMENT_EXTENSIONS=t.ML_ENDPOINT_FETCH_TYPES=t.ML_EXPERIMENT_TYPES=void 0,t.ML_EXPERIMENT_TYPES={contract:"CONTRACT",esign:"ESIGN",control:"CONTROL",file:"FILE"},t.ML_ENDPOINT_FETCH_TYPES=["CONTRACT","ESIGN"],t.ML_EXPERIMENT_EXTENSIONS=["pdf","docx"],t.fetchDocClassification=function(e,t){var n={file_id:t};return(new r.UserApiV2Client).ns("hellosign").rpc("get_classification",n,{subjectUserId:e})}})),define("modules/clean/react/comments2/data/store",["require","exports","tslib","lodash","modules/clean/redux/namespaces","modules/clean/react/comments2/data/reducer","modules/clean/redux/store"],(function(e,t,r,n,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getStoreForComments2=void 0,n=r.__importStar(n),t.getStoreForComments2=n.once((function(){var e;return o.getStoreAndRegisterReducers(((e={})[a.COMMENTS2_NAMESPACE_KEY]=i.reducer,e))}))})),define("modules/clean/react/file_sidebar/store/instance",["require","exports","tslib","redux","modules/clean/react/file_sidebar/store/app/reducer","modules/clean/react/file_sidebar/store/file_activity/reducer","modules/clean/react/file_sidebar/store/sidebar/reducer","modules/clean/react/file_sidebar/store/middleware/thunk","modules/clean/react/file_sidebar/store/middleware/reactor","modules/clean/react/file_sidebar/store/sidebar/reactors","modules/clean/redux/unsupported","modules/clean/redux/devtools"],(function(e,t,r,n,a,i,o,s,c,u,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.store=void 0;var m=(n=r.__importStar(n)).combineReducers({app:a.reducer,fileActivity:i.reducer,sidebar:o.reducer});function g(e,t){return"::RESET"===t.type&&(e=void 0),m(e,t)}t.store=l.createStore(g,d.composeEnhancersWithDevTools(n.applyMiddleware(s.thunk(),c.reactor(u.reactors))))})),define("modules/clean/react/file_sidebar/store/sidebar/actions",["require","exports","tslib","modules/clean/react/file_sidebar/store/file_activity/selectors","modules/clean/react/file_sidebar/store/sidebar/helpers","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/types","file-viewer/core/index"],(function(e,t,r,n,a,i,o,s,c){"use strict";function u(e){return function(t,r){t({type:s.ActionType.SidebarOpen,payload:{reason:e}})}}function l(){return function(e,t){var r=t(),a=i.getSidebarContext(r).user;i.getSidebarState(r).open&&(e({type:s.ActionType.SidebarClose}),o.logSidebarClosed({num_comments:i.getTabState(r,"comments").extra.commentCount,num_events:n.getVisibleActivityCount(r),viewing_user_id:a?a.id:null}))}}function d(){return{type:s.ActionType.SidebarIndicateNewFileNav}}Object.defineProperty(t,"__esModule",{value:!0}),t.OverrideInitialState=t.setCommentingOnNewFile=t.setComments2ShownState=t.setComments2DisabledState=t.openFile=t.thirdpartyBlueDotOnboard=t.selectTab=t.completeToggleOpen=t.toggle=t.close=t.open=t.reset=void 0,n=r.__importStar(n),a=r.__importStar(a),i=r.__importStar(i),t.reset=function(){return{type:s.ActionType.SidebarReset}},t.open=u,t.close=l,t.toggle=function(){return function(e,t){var r=t();i.getSidebarState(r).open?e(l()):e(u("toggle_button"))}},t.completeToggleOpen=function(){return function(e){e(u("toggle_button_after_transition"))}},t.selectTab=function(e){return{type:s.ActionType.SidebarSelectTab,payload:{tabName:e}}},t.thirdpartyBlueDotOnboard=function(){return{type:s.ActionType.SidebarSetThirdPartyBlueDotOnboardState}},t.openFile=function(e){return function(t,r){var n=r(),o=i.getSidebarContext(n);a.isContextChanged(o,e)&&(t({type:s.ActionType.SidebarOpenFile,payload:e}),t(d()))}},t.setComments2DisabledState=function(){return{type:s.ActionType.SidebarSetComments2DisabledState}},t.setComments2ShownState=function(e){return{type:s.ActionType.SidebarSetComments2ShownState,payload:e}},t.setCommentingOnNewFile=d,t.OverrideInitialState=function(e){var t=e===c.FileViewerMode.Documentation?"metadata":"comments";return{type:s.ActionType.SidebarOverrideInitialState,payload:{open:!0,tab:t}}}})),define("modules/clean/react/comments2/data/reducer",["require","exports","tslib","lodash","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/initial_state","modules/clean/react/comments2/data/util","modules/clean/react/comments2/data/reducer_helper","modules/clean/react/comments2/data/types","comments2/transforms/index","modules/clean/react/file_metadata/data/type_guards","modules/clean/react/comments2/video_annotations/annotation_helper"],(function(e,t,r,n,a,i,o,s,c,u,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reducer=void 0,n=r.__importStar(n),u=r.__importStar(u);var m=s.createStatusReducer(a.ActionTypes),g=s.createActionReducer(),_=s.createReducerFrom(g(a.ActionTypes.SetContext,(function(e,t){return t?r.__assign(r.__assign({},t),{status:c.Comments2ContextStatus.Pending}):void 0})),g(a.ActionTypes.SetContextStatus,(function(e,t){return r.__assign(r.__assign({},e),{status:t})})));function p(e,t,r){return e.map((function(e){return e.id===t?r(e):e}))}function f(e,t,a){var i=e.threads[t];return i?(function(e,t){var n;return r.__assign(r.__assign({},e),{threads:r.__assign(r.__assign({},e.threads),(n={},n[t.id]=t,n))})})(e,n.assignIn({},i,a)):e}function h(e,t,n,a){var i,o=t.threads[n];return o?f(t,n,o.pending?r.__assign(r.__assign({},o),((i={})[a]=o.pending.originalValue,i.pending=r.__assign(r.__assign({},o.pending),{error:e}),i)):o):t}function v(e,t,r,n){var a=e.threads[r];return a?f(e,r,{comments:p(a.comments,t,n)}):e}function S(e,t,n,a,i){return v(t,n,a,(function(t){var n;return t.pending?r.__assign(r.__assign({},t),((n={})[i]=t.pending.originalValue,n.pending=r.__assign(r.__assign({},t.pending),{error:e}),n)):t}))}var b=s.createActionReducer(),y=s.createReducerFrom(b(a.ActionTypes.ActivateThread,(function(e,t){var n=t.thread,a=t.pendingAnnotationInfo,i=t.wasPreviewLayerClick;return r.__assign(r.__assign({},e),{activatedThreadId:n.id,documentRectangleToMakeVisible:i?void 0:o.documentRectangleFromThread(n),pendingAnnotationInfo:a||e.pendingAnnotationInfo})})),b(a.ActionTypes.DeactivateAllThreads,(function(e){return n.assignIn({},e,{activatedThreadId:void 0,activatedDocumentAnnotationRectangle:void 0})})),b(a.ActionTypes.ListComments,{Success:function(e,t,n){var a=r.__assign(r.__assign({},e.authors),u.usersToIUserMap(t.authors)),i=r.__assign(r.__assign({},e.threads),u.threadsToIThreadMap(t.threads,a,t.currentRevision));return r.__assign(r.__assign({},e),{threads:i,authors:a,cursor:t.cursor,listCommentsError:void 0})},Error:function(e,t,n){return r.__assign(r.__assign({},e),{listCommentsError:t})}}),b(a.ActionTypes.CreateThread,{Request:function(e,t,n){var i,s=new Date,c=n.annotation,u=n.author,l=n.content,d=n.guid,m={id:d,timestamp:s,read:!0,readonly:!0,isThirdParty:!1,resolved:!1,comments:[{id:d,threadId:d,timestamp:s,author:u,content:l,revisionInfo:{isCurrent:!0},userPermissions:{canDelete:!1,canEdit:!1}}],annotation:c},g=r.__assign(r.__assign({},m),{pending:{action:a.ActionTypes.CreateThread.name,originalValue:void 0,pendingValue:m}}),_=e.pendingAnnotationInfo.annotationMayBeOffscreen?o.documentRectangleFromThread(m):void 0;return r.__assign(r.__assign({},e),{activatedThreadId:d,documentRectangleToMakeVisible:_,threads:r.__assign(r.__assign({},e.threads),(i={},i[d]=g,i))})},Success:function(e,t,n){var a,i=n.guid,o=e.threads,s=i,c=o[s],u=r.__rest(o,["symbol"==typeof s?s:s+""]),l=p(c.comments,i,(function(e){return r.__assign(r.__assign({},e),{id:t.id,userPermissions:{canDelete:!0,canEdit:!(e.content.metadata[0]&&"sticker"===e.content.metadata[0].type)},readonly:!1})}));return r.__assign(r.__assign({},e),{activatedThreadId:e.activatedThreadId===n.guid?t.id:e.activatedThreadId,threads:r.__assign(r.__assign({},u),(a={},a[t.id]=r.__assign(r.__assign({},c),{id:t.id,comments:l,pending:void 0}),a))})},Error:function(e,t,n){var a=e.threads,i=n.guid,o=(a[i],r.__rest(a,["symbol"==typeof i?i:i+""]));return r.__assign(r.__assign({},e),{threads:o})}}),b(a.ActionTypes.ReplyToThread,{Request:function(e,t,n){var i,o=new Date,s=n.author,c=n.content,u=n.guid,l=n.threadId,d={id:u,threadId:l,timestamp:o,author:s,content:c,revisionInfo:{isCurrent:!0},userPermissions:{canDelete:!1,canEdit:!1}},m=e.threads[l],g=r.__assign(r.__assign({},m),{read:!0,comments:r.__spreadArrays(m.comments,[d])}),_=r.__assign(r.__assign({},g),{pending:{action:a.ActionTypes.ReplyToThread.name,originalValue:m,pendingValue:g}});return r.__assign(r.__assign({},e),{activatedThreadId:l,threads:r.__assign(r.__assign({},e.threads),(i={},i[l]=_,i))})},Success:function(e,t,n){var a,i=n.guid,o=n.threadId,s=e.threads[o],c=p(s.comments,i,(function(e){return r.__assign(r.__assign({},e),{id:t.id,userPermissions:{canDelete:!0,canEdit:!(e.content.metadata[0]&&"sticker"===e.content.metadata[0].type)}})}));return r.__assign(r.__assign({},e),{threads:r.__assign(r.__assign({},e.threads),(a={},a[o]=r.__assign(r.__assign({},s),{comments:c,pending:void 0}),a))})},Error:function(e,t,n){var a,i=e.threads[n.threadId],o=i.comments.filter((function(e){return e.id!==n.guid}));return r.__assign(r.__assign({},e),{threads:r.__assign(r.__assign({},e.threads),(a={},a[n.threadId]=r.__assign(r.__assign({},i),{comments:o,pending:void 0}),a))})}}),b(a.ActionTypes.DeleteComment,{Request:function(e,t,n){return v(e,n.commentId,n.threadId,(function(e){return r.__assign(r.__assign({},e),{deleted:!0,pending:{action:a.ActionTypes.DeleteComment.name,originalValue:e.deleted,pendingValue:!0}})}))},Success:function(e,t,n){return v(e,n.commentId,n.threadId,(function(e){return r.__assign(r.__assign({},e),{pending:void 0})}))},Error:function(e,t,r){return S(t,e,r.commentId,r.threadId,"deleted")}}),b(a.ActionTypes.EditComment,{Request:function(e,t,n){return v(e,n.commentId,n.threadId,(function(e){return r.__assign(r.__assign({},e),{content:n.content,pending:{action:a.ActionTypes.EditComment.name,originalValue:e.content,pendingValue:n.content}})}))},Success:function(e,t,n){return v(e,n.commentId,n.threadId,(function(e){return r.__assign(r.__assign({},e),{pending:void 0})}))},Error:function(e,t,r){return S(t,e,r.commentId,r.threadId,"content")}}),b(a.ActionTypes.SetPerfData,(function(e,t){return r.__assign(r.__assign({},e),{perfEvents:r.__assign(r.__assign({},e.perfEvents),t)})})),b(a.ActionTypes.CheckOnboardingStatus,(function(e,t){return r.__assign(r.__assign({},e),{onboardingVariants:{premium_av_comments_pane_surface:!1===t.premium_av_comments_pane_surface,premium_av_preview_surface:!1===t.premium_av_preview_surface,non_premium_av_comments_pane_surface:!1===t.non_premium_av_comments_pane_surface,not_annotatable_file_comments_pane_surface:!1===t.not_annotatable_file_comments_pane_surface,how_to_at_mention_comments_pane_surface:!1===t.how_to_at_mention_comments_pane_surface,image_preview_surface:!1,document_preview_surface:!1,share_as_comment:!1===t.share_as_comment}})})),b(a.ActionTypes.MarkOnboarded,(function(e,t,n){var a;return r.__assign(r.__assign({},e),{onboardingVariants:r.__assign(r.__assign({},e.onboardingVariants),(a={},a[n]=!1,a))})})),b(a.ActionTypes.GetMediaFeatures,(function(e,t){return r.__assign(r.__assign({},e),{framePreciseCommentsEnabled:t.frame_precise_comments})})),b(a.ActionTypes.GetFileMetadata,(function(e,t){return r.__assign(r.__assign({},e),{frameRate:l.isVideoSpecificMetadata(t.metadata)?t.metadata.frame_rate_precise?t.metadata.frame_rate_precise:t.metadata.frame_rate:void 0})})),b(a.ActionTypes.MarkModalVariantShown,(function(e,t){var n;return r.__assign(r.__assign({},e),{modalVariantsShown:r.__assign(r.__assign({},e.modalVariantsShown),(n={},n[t]=!0,n))})})),b(a.ActionTypes.DismissOnboarding,(function(e){return r.__assign(r.__assign({},e),{onboardingVariants:n.mapValues(e.onboardingVariants,(function(){return!1}))})})),b(a.ActionTypes.MarkThreadRead,{Request:function(e,t,r){return f(e,r.threadId,{read:!0,pending:{action:a.ActionTypes.MarkThreadRead.name,originalValue:e.threads[r.threadId].read,pendingValue:!0}})},Success:function(e,t,r){return f(e,r.threadId,{pending:void 0})},Error:function(e,t,r){return h(t,e,r.threadId,"read")}}),b(a.ActionTypes.MarkThreadUnread,{Request:function(e,t,r){return f(e,r,{read:!1,pending:{action:a.ActionTypes.MarkThreadUnread.name,originalValue:e.threads[r].read,pendingValue:!1}})},Success:function(e,t,r){return f(e,r,{pending:void 0})},Error:function(e,t,r){return h(t,e,r,"read")}}),b(a.ActionTypes.MarkThreadResolved,{Request:function(e,t,r){var n={type:"with_details",resolver:r.resolver,resolvedTimestamp:new Date};return f(e,r.threadId,{resolvedInfo:n,pending:{action:a.ActionTypes.MarkThreadResolved.name,originalValue:e.threads[r.threadId].resolvedInfo,pendingValue:n}})},Success:function(e,t,r){return f(e,r.threadId,{pending:void 0})},Error:function(e,t,r){return h(t,e,r.threadId,"resolvedInfo")}}),b(a.ActionTypes.MarkThreadUnresolved,{Request:function(e,t,r){return f(e,r,{resolvedInfo:void 0,pending:{action:a.ActionTypes.MarkThreadUnresolved.name,originalValue:e.threads[r].resolvedInfo,pendingValue:void 0}})},Success:function(e,t,r){return f(e,r,{pending:void 0})},Error:function(e,t,r){return h(t,e,r,"resolvedInfo")}}),b(a.ActionTypes.SetContext,(function(e,t){return r.__assign(r.__assign({},e),n.pick(i.INITIAL_STATE.data,"activatedThreadId","authors","cursor","documentMetadata","enabledStatus","pendingAnnotationInfo","playerIntegrationEnabled","requestEditorFocus","canSeeCommentEditor","subscriptionStatus","threads"))})),b(a.ActionTypes.ToggleShowResolved,(function(e){return r.__assign(r.__assign({},e),{showResolved:!e.showResolved})})),b(a.ActionTypes.UpdateEditorIsEmpty,(function(e,t){return r.__assign(r.__assign({},e),{editorIsEmpty:t})})),b(a.ActionTypes.UpdateDocumentCurrentPage,(function(e,t){return r.__assign(r.__assign({},e),{pendingAnnotationInfo:r.__assign(r.__assign({},e.pendingAnnotationInfo),{currentPageNumber:t})})})),b(a.ActionTypes.UpdatePlayerCurrentTime,(function(e,t){return r.__assign(r.__assign({},e),{pendingAnnotationInfo:r.__assign(r.__assign({},e.pendingAnnotationInfo),{playerCurrentTime:d.VideoAnnotationHelper.unitConvertSecondsToDomainObjectTime(t),playerCurrentTimeSec:t})})})),b(a.ActionTypes.HoverThread,(function(e,t){return r.__assign(r.__assign({},e),{hoverThreadId:t})})),b(a.ActionTypes.FocusThread,(function(e,t){return r.__assign(r.__assign({},e),{focusedThreadId:t})})),b(a.ActionTypes.SetPendingNumberedAnnotation,(function(e,t){return r.__assign(r.__assign({},e),{pendingAnnotationInfo:r.__assign(r.__assign({},e.pendingAnnotationInfo),{numberedAnnotation:t,annotationMayBeOffscreen:!1})})})),b(a.ActionTypes.ClearPendingNumberedAnnotation,(function(e,t){return r.__assign(r.__assign({},e),{pendingAnnotationInfo:r.__assign(r.__assign({},e.pendingAnnotationInfo),{numberedAnnotation:void 0,annotationMayBeOffscreen:!1})})})),b(a.ActionTypes.SetPendingNumberedAnnotationMayBeOffscreen,(function(e){return r.__assign(r.__assign({},e),{pendingAnnotationInfo:r.__assign(r.__assign({},e.pendingAnnotationInfo),{annotationMayBeOffscreen:!0})})})),b(a.ActionTypes.TrackSidebarCommentsVisibility,(function(e,t){return r.__assign(r.__assign({},e),{visibleInSidebar:t})})),b(a.ActionTypes.DocMetadataLoad,(function(e,t){return r.__assign(r.__assign({},e),{documentMetadata:t})})),b(a.ActionTypes.RequestEditorFocus,(function(e){return r.__assign(r.__assign({},e),{requestEditorFocus:!0})})),b(a.ActionTypes.FulfillEditorFocusRequest,(function(e){if(!e.requestEditorFocus)throw new Error("Fulfilling request for editor focus, but isnt requested in store");return r.__assign(r.__assign({},e),{requestEditorFocus:!1})})),b(a.ActionTypes.EnablePlayerIntegration,(function(e,t){return r.__assign(r.__assign({},e),{playerIntegrationEnabled:!0})})),b(a.ActionTypes.SetUpsellTooltipVariant,(function(e,t){return r.__assign(r.__assign({},e),{upsellTooltipVariant:t})})),b(a.ActionTypes.SetThirdPartySource,(function(e,t){return r.__assign(r.__assign({},e),{thirdPartySource:t})})),b(a.ActionTypes.SetCanSeeCommentEditor,(function(e,t){return r.__assign(r.__assign({},e),{canSeeCommentEditor:t})})),b(a.ActionTypes.RecordEnabledStatus,(function(e,t){return r.__assign(r.__assign({},e),{enabledStatus:n.merge({},e.enabledStatus,t)})})),b(a.ActionTypes.SetSubscriptionStatus,(function(e,t){return r.__assign(r.__assign({},e),{subscriptionStatus:t})})),b(a.ActionTypes.Subscribe,(function(e){return r.__assign(r.__assign({},e),{subscriptionStatus:n.merge({},e.subscriptionStatus,{isSubscribed:!0})})})),b(a.ActionTypes.Unsubscribe,(function(e){return r.__assign(r.__assign({},e),{subscriptionStatus:n.merge({},e.subscriptionStatus,{isSubscribed:!1})})})),b(a.ActionTypes.ResetStore,(function(e,t){return r.__assign({},i.INITIAL_STATE.data)})),b(a.ActionTypes.GetStickers,(function(e,t){return r.__assign(r.__assign({},e),{stickers:t.sticker_sets})})));t.reducer=function(e,t){void 0===e&&(e=i.INITIAL_STATE);var r=_(e.context,t),n=y(e.data,t),a=m(e.statuses,t);return r!==e.context||n!==e.data||a!==e.statuses?{context:r,data:n,statuses:a}:e}})),define("modules/clean/react/comments2/data/action_helper",["require","exports","tslib","modules/clean/react/comments2/data/selectors","modules/clean/react/comments2/util"],(function(e,t,r,n,a){"use strict";function i(e){return{error:e+".Error",request:e+".Request",success:e+".Success"}}function o(e){return{actionTypes:i(e),name:e,type:"async"}}function s(e){return{actionType:e,name:e,type:"sync",zero:!1}}function c(e){return{actionType:e,name:e,type:"sync",zero:!0}}function u(){var e=this;return function(t,i){return r.__awaiter(e,void 0,void 0,(function(){var e,o,s,c,u,l,d;return r.__generator(this,(function(r){switch(r.label){case 0:return e=i.action,o=i.args,s=i.dispatch,c=i.context,u=i.getState,a.isContextSame(c,n.getContext(u()))?[3,2]:[4,t(i)];case 1:return[2,r.sent()];case 2:s({type:e.actionTypes.request,payload:o,meta:{args:o}}),r.label=3;case 3:return r.trys.push([3,5,,6]),[4,t(i)];case 4:return l=r.sent(),s({type:e.actionTypes.success,payload:l,meta:{args:o}}),[2,l];case 5:throw d=r.sent(),s({type:e.actionTypes.error,error:d,meta:{args:o}}),d;case 6:return[2]}}))}))}}Object.defineProperty(t,"__esModule",{value:!0}),t.asyncHandler=t.thunkHandler=t.dispatchMiddleware=t.createAsyncHandler=t.syncHandler=t.namespacedActions=t.syncAction0=t.syncAction=t.asyncAction=t.asyncActionConstants=t.errorReduxAction=t.successReduxAction=t.requestReduxAction=t.syncReduxAction=void 0,n=r.__importStar(n),t.syncReduxAction=function(e,t){return e.zero?{type:e.actionType}:{type:e.actionType,payload:t}},t.requestReduxAction=function(e,t){return{type:e.actionTypes.request,payload:t,meta:{args:t}}},t.successReduxAction=function(e,t,r){return{type:e.actionTypes.success,payload:r,meta:{args:t}}},t.errorReduxAction=function(e,t,r){return{type:e.actionTypes.error,error:r,meta:{args:t}}},t.asyncActionConstants=i,t.asyncAction=o,t.syncAction=s,t.syncAction0=c,t.namespacedActions=function(e){return{asyncAction:function(t){return o(e+"/"+t)},syncAction:function(t){return s(e+"/"+t)},syncAction0:function(t){return c(e+"/"+t)}}},t.syncHandler=function(e){return e.zero?function(){return{type:e.name}}:function(t){return{payload:t,type:e.name}}},t.createAsyncHandler=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,a){return function(i){return function(o,s){return r.__awaiter(void 0,void 0,void 0,(function(){var c,u;return r.__generator(this,(function(l){switch(l.label){case 0:c=n.getContext(s()),u=e.reduceRight((function(e,t){return function(n){return r.__awaiter(void 0,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,t(e,n)];case 1:return[2,r.sent()]}}))}))}}),(function(e){return a(i,e)})),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,u({action:t,args:i,dispatch:o,getState:s,context:c})];case 2:return[2,l.sent()];case 3:return l.sent(),[3,4];case 4:return[2]}}))}))}}}},t.dispatchMiddleware=u,t.thunkHandler=t.createAsyncHandler(),t.asyncHandler=t.createAsyncHandler(u())})),define("modules/clean/react/file_activity_stream/tti_logger",["require","exports","modules/clean/react/file_sidebar/file_sidebar_logger"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.faStreamTTILogger=void 0;var n=(function(){function e(){this.hasLogged=!1}return e.prototype.recordStart=function(e){this.startTs=(new Date).getTime(),this.fileId=e,this.hasLogged=!1},e.prototype.recordInteractive=function(e){if(!this.hasLogged&&e===this.fileId&&this.startTs){var t=(new Date).getTime();r.logActivityStreamInteractivity({time_start:this.startTs,time_interactive:t}),this.hasLogged=!0}},e})();t.faStreamTTILogger=new n})),define("modules/clean/react/file_sidebar/store/sidebar/reactors",["require","exports","tslib","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/store/file_activity/selectors"],(function(e,t,r,n,a,i){"use strict";function o(e){var t=a.getSidebarState(e),r=t.open,n=t.ready;return r&&n}function s(e){return!o(e)}function c(e){var t=a.getSidebarContext(e).user;n.logSidebarOpened({reason:a.getOpenReason(e),num_comments:a.getTabState(e,"comments").extra.commentCount,num_events:i.getVisibleActivityCount(e),viewing_user_id:t?t.id:null})}Object.defineProperty(t,"__esModule",{value:!0}),t.reactors=void 0,a=r.__importStar(a),i=r.__importStar(i),t.reactors=function(e){e({changesFrom:s,changesTo:o},(function(e){c(e.nextState)})),e({changes:function(e,t){if(o(e)&&o(t)){var r=t.sidebar.tabs,n=e.sidebar.tabs;return!(n.activity.ready&&n.comments.ready)&&r.activity.ready&&r.comments.ready}return!1}},(function(e){c(e.nextState)}))}})),define("modules/clean/react/workflows/markup/markup_layer",["require","exports","tslib","react","react-redux","lodash","modules/clean/react/workflows/markup/fabric_wrapper","modules/clean/react/css","modules/clean/react/workflows/markup/selectors","modules/clean/react/file_viewer/data/actions","modules/clean/react/workflows/markup/types","modules/clean/react/workflows/markup/fabric"],(function(e,t,r,n,a,i,o,s,c,u,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MarkupLayer=t._MarkupLayer=t.ConnectedMarkupLayer=void 0;var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSelectionChange=function(e){if(e.selected){var r=e.selected,n=r.some((function(e){return["circle","rect"].includes(e.type||"")}))?[l.FormatSubmenuEntry.FILL,l.FormatSubmenuEntry.STROKE]:[l.FormatSubmenuEntry.STROKE];t.props.setMarkupFormatSubmenu(n);var a=r.filter((function(e){return d.getStroke(e)})),i=d.getStroke(a[0]),o=a.every((function(e){return d.getStroke(e)===i})),s=r.filter((function(e){return d.getFill(e)})),c=d.getFill(s[0]),u=s.every((function(e){return d.getFill(e)===c}));i&&o&&t.props.setMarkupStroke(i),c&&u&&t.props.setMarkupFill(c)}},t.handleObjectMoving=function(e){var t=e.target;if(t&&t.canvas&&null!=t.top&&null!=t.left){t.setCoords();var r=t.canvas.getWidth(),n=t.canvas.getHeight(),a=t.getBoundingRect().width,i=t.getBoundingRect().height,o=t.getBoundingRect().top,s=t.getBoundingRect().left;if(!(i>n||a>r)){var c=.9*a,u=.9*i,l=Math.max(t.top,t.top-o-u),d=Math.max(t.left,t.left-s-c);t.top=Math.min(l,n+u-i+t.top-o),t.left=Math.min(d,r+c-a+t.left-s),t.setCoords()}}},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.createFabricCanvas(),t=this.props.markupState[this.props.page];t&&t.fabric&&e.loadFromJSON(t.fabric.toJSON(),(function(){e.requestRenderAll()})),this.props.setMarkupCanvas(this.props.page,e,this.getCanvasSize().scale)},t.prototype.createFabricCanvas=function(){var e=new o.fabric.Canvas(this.canvasId);return e.on("selection:updated",this.handleSelectionChange),e.on("selection:created",this.handleSelectionChange),e.on("object:moving",this.handleObjectMoving),e.isDrawingMode=this.props.markupState.isDrawingMode,e},t.prototype.componentDidUpdate=function(){var e=this.props,t=e.markupState,r=e.page,n=this.getCanvasSize(),a=n.width,i=n.height,o=n.scale,s=t[r]&&t[r].fabric;if(s)s.setDimensions({width:a,height:i}),this.props.updateMarkupCanvasScale(r,o);else{var c=this.createFabricCanvas();this.props.setMarkupCanvas(r,c,o)}},t.prototype.shouldComponentUpdate=function(e){return this.props.page!==e.page||!i.isEqual(this.props.pageDimensions,e.pageDimensions)||!i.isEqual(this.props.layerSize,e.layerSize)},t.prototype.getCanvasSize=function(){var e=this.props.layerSize.width,t=this.props.pageDimensions||this.props.layerSize,r=t.width,n=t.height,a=e/r;return{width:Math.round(r*a),height:Math.round(n*a),scale:a}},t.prototype.render=function(){var e=this.getCanvasSize(),t=e.width,r=e.height,a={width:t+"px",height:r+"px"};return this.canvasId="markup-canvas"+this.props.page,n.default.createElement("div",{className:"fv-markup-layer",style:a},n.default.createElement("canvas",{id:this.canvasId,width:t,height:r}))},t})((n=r.__importDefault(n)).default.Component);t._MarkupLayer=m;var g=a.connect((function(e){return{markupState:c.getMarkupState(e)}}),{setMarkupCanvas:u.setMarkupCanvas,updateMarkupCanvasScale:u.updateMarkupCanvasScale,setMarkupFormatSubmenu:u.setMarkupFormatSubmenu,setMarkupFill:u.setMarkupFill,setMarkupStroke:u.setMarkupStroke});t.ConnectedMarkupLayer=g(m);var _=s.requireCssWithComponent(t.ConnectedMarkupLayer,["/static/css/file_viewer/markup_layer-vflF_C1Ab.css"]);t.MarkupLayer=_})),define("modules/clean/previews/pending_upload_watcher",["require","exports","tslib","modules/clean/deprecated_ajax/ajax_jquery","modules/clean/react/file_viewer/data/actions","modules/core/browser","modules/core/uri"],(function(e,t,r,n,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PendingUploadWatcher=void 0,n=r.__importStar(n),i=r.__importStar(i);var s=(function(){function e(e,t,r){void 0===r&&(r=""),this.pollUrl=new o.URI({path:"/sp/"}).updateQuery({link_type:e,link_key:t,secure_hash:r}).toString()}return e.prototype.startPolling=function(){this.pollPending()},e.prototype.pollSuccess=function(e){var t=JSON.parse(e);t.hasOwnProperty("upload_status")&&"complete"===t.upload_status?a.pendingFileUploaded():setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollFailure=function(e){e.status<400||e.status>=500?this.retryPoll():i.reload(!0)},e.prototype.retryPoll=function(){setTimeout(this.pollPending.bind(this),2e3)},e.prototype.pollPending=function(){var e=this;n.SilentBackgroundRequest({url:this.pollUrl,success:function(t){e.pollSuccess(t)},error:function(t){e.pollFailure(t)}})},e})();t.PendingUploadWatcher=s})),define("modules/clean/react/open_in_app/button",["require","exports","tslib","react","spectrum/button","modules/clean/open_in_app/actions","modules/core/i18n","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants"],(function(e,t,r,n,a,i,o,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenInAppButton=void 0;var u=(function(e){function t(t){var r=e.call(this,t)||this;return r.handleClick=function(){s.logUserAction(c.UserAction.OpenInApp,r.props.userActionContext),i.openInApp(r.props.urls,{onAppNeeded:function(){return r.setState({showInstallAppText:!0})},onAppInstalled:function(){return r.setState({showInstallAppText:!1})}})},r.state={showInstallAppText:!1},r}return r.__extends(t,e),t.prototype.componentWillUnmount=function(){i.cleanUp()},t.prototype.render=function(){return n.default.createElement(a.Button,{className:"control__button open-in-app-button",variant:"primary",onClick:this.handleClick},this.state.showInstallAppText?o.intl.formatMessage({id:"RgopQo",defaultMessage:"Install app?"}):o.intl.formatMessage({id:"B9kRrE",defaultMessage:"Open in app"}))},t})((n=r.__importDefault(n)).default.Component);t.OpenInAppButton=u})),define("modules/clean/react/comments2/data/selectors",["require","exports","tslib","lodash","reselect","modules/clean/redux/selectors","modules/clean/redux/namespaces","modules/clean/react/comments2/data/types","modules/clean/react/comments2/data/util","modules/clean/react/comments2/util","modules/clean/react/file_viewer/data/selectors","modules/clean/previews/constants","modules/clean/previews/data/preview_type_util","modules/clean/react/file_viewer/data/selectors","comments2/transforms/index"],(function(e,t,r,n,a,i,o,s,c,u,l,d,m,g,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getThirdPartySource=t.getIsEditorFocusRequested=t.getDocumentMetadata=t.getStreamSettings=t.getDisplayedThreadsWithNumberedAnnotations=t.getDisplayedThreadsWithImageAnnotations=t.getDisplayedThreadsWithDocumentAnnotationsOnPage=t.getDisplayedThreadsForLayer=t.getVisibleInSidebar=t.getHasPendingNumberedAnnotation=t.getPendingNumberedAnnotation=t.getCurrentPageNumber=t.getPlayerCurrentTimeSec=t.getPlayerCurrentTime=t.getStreamId=t.getStream=t.getIsSubscribed=t.getCanSubscribe=t.getCanEnable=t.getStickers=t.getIsPlayerIntegrationEnabled=t.getStatuses=t.getShowResolved=t.getUnresolvedTimecodeThreads=t.getFocusedThreadId=t.getHoverThreadId=t.getListCommentsError=t.getDocumentRectangleToMakeVisibleIfComments2Ready=t.getActivatedTimecodeThread=t.getActivatedThread=t.getActivatedThreadId=t.getFrameRate=t.getFramePreciseCommentsEnabled=t.getHasShownAnyModalVariant=t.getOnboardingVariants=t.getShowOnboardingOnCommentsPane=t.getShowShareAsCommentOnboarding=t.getShowOnboardingOnVideo=t.getUnmarkedOnboardingKeysRelevantToCurrentFile=t.getCursor=t.getThreads=t.getThreadMap=t.getEditorIsEmpty=t.getSort=t.getRevision=t.getData=t.getIsComments2Ready=t.getPreviewTypeForCurrentFile=t.canCreateAnnotations=t.getViewerId=t.getViewer=t.getFQPath=t.isEnabled=t.getContextStatus=t.getContext=t.getState=t.IMAGE_SENTINEL=void 0,n=r.__importStar(n),u=r.__importStar(u),g=r.__importStar(g);t.IMAGE_SENTINEL="IMAGE_SENTINEL",t.getState=function(e){return i.getStateAtNamespace(e,o.COMMENTS2_NAMESPACE_KEY)};t.getContext=function(e){var r=t.getState(e).context;return r?{stream:r.stream,viewer:r.viewer}:void 0},t.getContextStatus=function(e){var r=t.getState(e).context;return r?r.status:void 0};var p=a.createSelector(t.getContextStatus,(function(e){return e===s.Comments2ContextStatus.FullyEnabled})),f=a.createSelector(t.getContextStatus,(function(e){return e===s.Comments2ContextStatus.ReadOnly}));function h(e){return m.getPreviewType(g.getPreviewApiDataForCurrentFile(e))}function v(e){return a.createSelector(t.getData,(function(t){return t[e]}))}t.isEnabled=a.createSelector([p,f],(function(e,t){return e||t})),t.getFQPath=function(e){var r=t.getContext(e);return r?r.stream.fq_path:void 0},t.getViewer=function(e){var r=t.getContext(e);return r?r.viewer:void 0},t.getViewerId=function(e){var r=t.getViewer(e);return r?r.id:void 0},t.canCreateAnnotations=function(e){var r=t.getContext(e);return!(!r||!r.viewer)&&!u.isComments2Mobile()&&t.getVisibleInSidebar(e)},t.getPreviewTypeForCurrentFile=h,t.getIsComments2Ready=function(e){var t=e[o.COMMENTS2_NAMESPACE_KEY];return!(!t||!t.context||t.context.status!==s.Comments2ContextStatus.FullyEnabled&&t.context.status!==s.Comments2ContextStatus.ReadOnly)},t.getData=function(e){return t.getState(e).data},t.getRevision=a.createSelector(t.getContext,(function(e){return e&&_.streamToRevision(e.stream)})),t.getSort=a.createSelector(h,(function(e){switch(e){case d.PreviewType.Audio:case d.PreviewType.Video:return s.SortType.VideoTimeCode;default:return s.SortType.Chronological}})),t.getEditorIsEmpty=v("editorIsEmpty"),t.getThreadMap=v("threads");var S=a.createSelector(t.getThreadMap,(function(e){return n.values(e)})),b=a.createSelector(t.getContext,(function(e){return e&&e.stream.isVersionHistoryMode}));function y(e){return t.isEnabled(e)&&!u.isComments2Mobile()&&(function(e){var r=t.getData(e).onboardingVariants;switch(h(e)){case d.PreviewType.Audio:case d.PreviewType.Video:return t.getIsPlayerIntegrationEnabled(e)?r.premium_av_comments_pane_surface:r.non_premium_av_comments_pane_surface;case d.PreviewType.SsrDoc:case d.PreviewType.Image:return r.how_to_at_mention_comments_pane_surface;case void 0:return!1;default:return r.not_annotatable_file_comments_pane_surface}})(e)}t.getThreads=a.createSelector([S,t.getSort,b,t.getRevision],(function(e,t,a,i){var o=(function(e,t){switch(t){case s.SortType.Chronological:return n.sortBy(e,[function(e){return e.timestamp.getTime()}]);case s.SortType.VideoTimeCode:var a=n.partition(e,c.isThreadWithTimecodeAnnotation),i=a[0],o=a[1];return r.__spreadArrays(n.sortBy(i,[function(e){return e.annotation.time},function(e){return e.timestamp.getTime()}]),n.sortBy(o,[function(e){return e.timestamp.getTime()}]))}})(e,t);return a?(function(e,t){return e.filter((function(e){var r=e.comments[0].revisionInfo;return r.isCurrent||!t||r.revision&&r.revision.nsId===t.ns_id&&r.revision.sjId<=t.sjid}))})(o,i):o})),t.getCursor=v("cursor"),t.getUnmarkedOnboardingKeysRelevantToCurrentFile=function(e){var r,n=t.getData(e).onboardingVariants;switch(h(e)){case d.PreviewType.SsrDoc:case d.PreviewType.Image:r=["how_to_at_mention_comments_pane_surface"];break;case d.PreviewType.Audio:case d.PreviewType.Video:r=t.getIsPlayerIntegrationEnabled(e)?["premium_av_comments_pane_surface","premium_av_preview_surface"]:["non_premium_av_comments_pane_surface"];break;case void 0:return[];default:r=["not_annotatable_file_comments_pane_surface"]}return r.filter((function(e){return n[e]}))},t.getShowOnboardingOnVideo=function(e){var r=t.getData(e).onboardingVariants,n=!l.getIsMediaPlaying(e),a=l.getPauseCount(e);return t.isEnabled(e)&&!u.isComments2Mobile()&&t.getIsPlayerIntegrationEnabled(e)&&n&&!y(e)&&r.premium_av_preview_surface&&a%5==1&&a<15},t.getShowShareAsCommentOnboarding=function(e){return t.getData(e).onboardingVariants.share_as_comment},t.getShowOnboardingOnCommentsPane=y,t.getOnboardingVariants=function(e){return t.getData(e).onboardingVariants},t.getHasShownAnyModalVariant=function(e){var r=t.getData(e).modalVariantsShown;return r[s.ModalVariant.EmailVerifyModal]||r[s.ModalVariant.SignUpModal]},t.getFramePreciseCommentsEnabled=function(e){return t.getData(e).framePreciseCommentsEnabled},t.getFrameRate=function(e){return t.getData(e).frameRate},t.getActivatedThreadId=v("activatedThreadId"),t.getActivatedThread=a.createSelector(t.getActivatedThreadId,t.getThreadMap,(function(e,t){return e&&t[e]})),t.getActivatedTimecodeThread=function(e){var r=t.getActivatedThread(e);return r&&c.isThreadWithTimecodeAnnotation(r)?r:void 0};var w=v("documentRectangleToMakeVisible");t.getDocumentRectangleToMakeVisibleIfComments2Ready=function(e){return t.getIsComments2Ready(e)?w(e):void 0},t.getListCommentsError=v("listCommentsError"),t.getHoverThreadId=v("hoverThreadId"),t.getFocusedThreadId=v("focusedThreadId"),t.getUnresolvedTimecodeThreads=function(e){return(function(e){return t.getThreads(e).filter((function(e){return!e.resolvedInfo}))})(e).filter((function(e){var t=e.annotation;return t&&("video"===t.type||"audio"===t.type)}))},t.getShowResolved=v("showResolved"),t.getStatuses=function(e){return t.getState(e).statuses},t.getIsPlayerIntegrationEnabled=v("playerIntegrationEnabled"),t.getStickers=function(e){return t.getData(e).stickers},t.getCanEnable=function(e){return t.getData(e).enabledStatus.canEnable},t.getCanSubscribe=function(e){return t.getData(e).subscriptionStatus.canSubscribe},t.getIsSubscribed=function(e){return t.getData(e).subscriptionStatus.isSubscribed},t.getStream=function(e){var r=t.getContext(e);return r&&r.stream},t.getStreamId=function(e){var r=t.getContext(e);return r&&r.stream.id};var A=v("pendingAnnotationInfo");function T(e){return A(e).numberedAnnotation}t.getPlayerCurrentTime=function(e){return A(e).playerCurrentTime},t.getPlayerCurrentTimeSec=function(e){return A(e).playerCurrentTimeSec},t.getCurrentPageNumber=function(e){return A(e).currentPageNumber},t.getPendingNumberedAnnotation=T,t.getHasPendingNumberedAnnotation=function(e){return t.getIsComments2Ready(e)&&!!T(e)},t.getVisibleInSidebar=v("visibleInSidebar");var M=a.createSelector([t.getVisibleInSidebar,t.isEnabled,t.getShowResolved,S],(function(e,t,r,n){return e&&t?(r?n:n.filter((function(e){return!e.resolvedInfo}))).filter((function(e){return e.comments.some((function(e){return!e.deleted}))})):[]})),E=a.createSelector(M,(function(e){return e.filter(c.isThreadWithDocumentAnnotation)})),C=a.createSelector(E,(function(e){return n.groupBy(e,(function(e){return e.annotation.regions[0].page}))}));function I(e,t){return n.get(C(e),t,[])}function k(e){var t=e.annotation;return!!t&&("document"===t.type||"image"===t.type)}function F(e){return M(e).filter((function(e){return e&&void 0!==e.annotation&&"image"===e.annotation.type}))}t.getDisplayedThreadsForLayer=function(e,t){return void 0===t?F(e):I(e,t)},t.getDisplayedThreadsWithDocumentAnnotationsOnPage=I,t.getDisplayedThreadsWithImageAnnotations=F,t.getDisplayedThreadsWithNumberedAnnotations=function(e){return M(e).filter(k)};var R=v("canSeeCommentEditor");t.getStreamSettings=a.createSelector([p,t.getViewer,R],(function(e,t,r){return{canComment:e,canModifyThreads:r&&!!t,canShowEditor:r}})),t.getDocumentMetadata=function(e){switch(h(e)){case d.PreviewType.SsrDoc:return t.getData(e).documentMetadata;case d.PreviewType.Image:return t.IMAGE_SENTINEL;default:return}},t.getIsEditorFocusRequested=v("requestEditorFocus"),t.getThirdPartySource=v("thirdPartySource")})),define("modules/clean/react/comments2/data/actions",["require","exports","tslib","lodash","modules/core/browser","modules/core/i18n","modules/clean/redux/types","modules/clean/react/comments2/data/api","file-viewer/core/index","modules/clean/react/file_sidebar/store/instance","comments2/transforms/index","modules/clean/react/comments2/data/types","modules/clean/react/comments2/components/snackbars","modules/clean/react/comments2/util","modules/clean/react/comments2/data/logger","modules/clean/react/comments2/data/perf_util","modules/clean/react/comments2/data/selectors","comments2/components/utils/throttle-debounce","modules/clean/bolt","modules/clean/browse_interface","modules/clean/react/comments2/data/action_helper","modules/clean/react/file_sidebar/store/sidebar/actions","modules/clean/react/file_viewer/data/actions"],(function(e,t,r,n,a,i,o,s,c,u,l,d,m,g,_,p,f,h,v,S,b,y,w){"use strict";function A(e){var t=this,n=e.clientFn,a=e.successCallback,i=e.eventToLog;return function(e,o){return r.__awaiter(t,void 0,void 0,(function(){var t,c,u;return r.__generator(this,(function(r){switch(r.label){case 0:if(!(t=f.getContext(o()))||!t.viewer)throw new Error;c=new s.Comments2Api(t.viewer.id,t.stream),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,n(c)];case 2:return u=r.sent(),_.logEvent(i,{stream:t.stream}),a(e,o,u),[3,4];case 3:return r.sent(),_.logErrorEvent("error trying to execute client event "+i,{stream:t.stream}),[3,4];case 4:return[2]}}))}))}}function T(e){return function(r,n){r(Z(e));var a=e.thread,i=n(),o=f.getStream(i);_.logEvent("activate_thread",{stream:o,thread:a}),a.read||a.readonly||r(t.Actions.markThreadRead({threadId:a.id,origin:d.MarkThreadReadOrigin.ThreadActivated}))}}function M(){return A({clientFn:function(e){return e.enableCommenting()},successCallback:E,eventToLog:"enable_comments"})}function E(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return f.getStreamId(t())!==n.id?[2]:[4,e(G(d.Comments2ContextStatus.Pending))];case 1:return r.sent(),e(Y(!0,!1)),[2]}}))}))}function C(){return A({clientFn:function(e){return e.disableCommenting()},successCallback:I,eventToLog:"disable_comments"})}function I(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var a;return r.__generator(this,(function(r){return f.getStreamId(t())!==n.id?[2]:(a=f.getContext(t()),k(e,a,!0),[2])}))}))}function k(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,e(G(d.Comments2ContextStatus.Disabled))];case 1:return t.sent(),e(w.disableMode(c.FileViewerMode.Commenting)),[4,u.store.dispatch(y.setComments2DisabledState())];case 2:return t.sent(),[2]}}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.Actions=t.ActionTypes=t.perfLoggingMiddleware=t.statusHandlingMiddleware=t.setFileContext=t.bolt=t.disableCommenting=t.enableCommenting=t.HandleErrorArg=void 0,n=r.__importStar(n),a=r.__importStar(a),g=r.__importStar(g),_=r.__importStar(_),p=r.__importStar(p),f=r.__importStar(f),y=r.__importStar(y),Object.defineProperty(t,"HandleErrorArg",{enumerable:!0,get:function(){return m.ShowErrorSnackbarArg}}),t.enableCommenting=M,t.disableCommenting=C,t.bolt={client:null,subscribe:function(e,r,n){var a=e.app_id,i=e.revision,o=e.token,s=e.unique_id,c=new v.SignedChannelState(a,s,i,o);t.bolt.client?t.bolt.client.update_states([c]):(t.bolt.client=new v.BoltClient([c],r,n),t.bolt.client.start())},unsubscribe:function(){t.bolt.client&&(t.bolt.client.unsubscribe(),t.bolt.client=null)}};var F=g.createBackoff(),R=F.backoff,O=F.resetBackoff;function P(e){var n=this;return function(a,i){return r.__awaiter(n,void 0,void 0,(function(){var n,o,s;return r.__generator(this,(function(r){switch(r.label){case 0:return n=i(),o=f.getContext(n),g.isContextSame(o,e)?[3,2]:(t.bolt.unsubscribe(),a(j(e)),a(qe({setContextTime:+new Date,listCompleteTime:0})),e?(s=o&&o.viewer,e.viewer&&!g.isUserSame(s,e.viewer)&&(a(t.Actions.checkOnboardingStatus(void 0)),a(t.Actions.getMediaFeatures(void 0))),f.getStickers(n)||a(t.Actions.getStickers(void 0)),e.stream&&a(t.Actions.getFileMetadata({fileId:e.stream.id,linkUrl:e.stream.linkUrl})),[4,a(Y(!0))]):[3,2]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}}t.setFileContext=P;var D=b.namespacedActions("Comments2"),x=D.asyncAction,U=D.syncAction,L=D.syncAction0;function V(e){var t=this,n=e.handleError,a=e.handleSuccess;return function(e,o){return r.__awaiter(t,void 0,void 0,(function(){function t(){return r.__awaiter(this,void 0,void 0,(function(){var c,u,l,d;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e(o)];case 1:return c=r.sent(),[3,3];case 2:throw u=r.sent(),(l=(function(e,t){if(t instanceof s.Comments2Error&&(t.code===s.ErrorCode.FILE_NOT_FOUND||t.code===s.ErrorCode.PERMISSION_DENIED)&&e!==ne.name)return{message:i.intl.formatMessage({id:"CKj3RT",defaultMessage:"Either that file was deleted or you no longer have access to it."}),isRetriable:!1};switch(e){case he.name:case be.name:case Te.name:return{message:i.intl.formatMessage({id:"3hOA04",defaultMessage:"We were unable to post the comment."}),isRetriable:!0};case we.name:return{message:i.intl.formatMessage({id:"CiZnrG",defaultMessage:"We were unable to delete the comment."}),isRetriable:!0};case Fe.name:return{message:i.intl.formatMessage({id:"+YPQ5/",defaultMessage:"We were unable to resolve the thread."}),isRetriable:!0};case Oe.name:return{message:i.intl.formatMessage({id:"QUs54P",defaultMessage:"We were unable to unresolve the thread."}),isRetriable:!0};case Ee.name:return{message:i.intl.formatMessage({id:"Vgd16U",defaultMessage:"We were unable to mark the thread as read."}),isRetriable:!0};case Ie.name:return{message:i.intl.formatMessage({id:"4apXur",defaultMessage:"We were unable to mark the thread as unread."}),isRetriable:!0};case Ye.name:return{message:i.intl.formatMessage({id:"RmXnr0",defaultMessage:"We were unable to subscribe to the file."}),isRetriable:!0};case Je.name:return{message:i.intl.formatMessage({id:"oz0V3s",defaultMessage:"We were unable to unsubscribe from the file."}),isRetriable:!0};case $.name:case te.name:case ne.name:case de.name:case je.name:default:return null}})(o.action.name,u))&&n({message:l.message,retryFn:l.isRetriable?t:void 0}),u;case 3:return(d=(function(e){switch(e){case Ye.name:return{message:i.intl.formatMessage({id:"WQpgoO",defaultMessage:"You have subscribed to the file."})};case Je.name:return{message:i.intl.formatMessage({id:"8o4LmU",defaultMessage:"You have unsubscribed from the file."})};default:return null}})(o.action.name))&&a(d),[2,c]}}))}))}return r.__generator(this,(function(e){switch(e.label){case 0:return[4,t()];case 1:return[2,e.sent()]}}))}))}}function N(){return+new Date}function W(e){var t=this;return function(n,a){return r.__awaiter(t,void 0,void 0,(function(){function t(t){var r=e(a.action.name,t);if(r){var n=N();a.dispatch(wt(r,a.context,n-i))}}var i,o,c;return r.__generator(this,(function(e){switch(e.label){case 0:i=N(),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,n(a)];case 2:return o=e.sent(),[3,4];case 3:throw c=e.sent(),t(c instanceof s.Comments2Error?c.code:"unknown_error"),c;case 4:return t(),[2,o]}}))}))}}t.statusHandlingMiddleware=V,t.perfLoggingMiddleware=W;var H=b.createAsyncHandler(V({handleError:m.showErrorSnackbar,handleSuccess:m.showSuccessSnackbar}),(function(e,t){var r=t.context;if(!r)throw new Error("Bad state");var a=new s.Comments2LoggedOutApi(r.stream);return e(n.merge({},t,{api:a,context:r}))}),b.dispatchMiddleware()),B=b.createAsyncHandler(V({handleError:m.showErrorSnackbar,handleSuccess:m.showSuccessSnackbar}),(function(e,t){var r=t.context;if(!r||!r.viewer)throw new Error("Bad state");var a=new s.Comments2Api(r.viewer.id,r.stream);return e(n.merge({},t,{api:a,context:r}))}),(function(e){var t=this;return function(a,i){return r.__awaiter(t,void 0,void 0,(function(){var t,s;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,a(i)];case 1:return t=r.sent(),e(n.merge({},i,{payload:t,status:o.ApiClientStatus.Success})),[2,t];case 2:throw s=r.sent(),e(n.merge({},i,{error:s,status:o.ApiClientStatus.Error})),s;case 3:return[2]}}))}))}})((function(e){var t=e.context.stream,r=f.getThreadMap(e.getState());if(e.status===o.ApiClientStatus.Error)_.logErrorEvent("encountered an error with async api call "+e.action.name,{stream:t});else if(e.status===o.ApiClientStatus.Success){var n=e.args,a=e.payload;switch(e.action.name){case he.name:var i=r[a.id];_.logEvent("new_comment",{commentId:a.id,stream:t,thread:i});break;case be.name:i=r[n.threadId];_.logEvent("reply_to_comment",{commentId:a.id,stream:t,thread:i});break;case we.name:i=r[n.threadId];_.logEvent("delete_comment",{commentId:n.commentId,stream:t,thread:i});break;case Te.name:i=r[n.threadId];_.logEvent("edit_comment",{commentId:n.commentId,stream:t,thread:i});break;case Fe.name:i=r[n.threadId];_.logEvent("resolve_thread",{stream:t,thread:i});break;case Oe.name:i=r[n];_.logEvent("unresolve_thread",{stream:t,thread:i});break;case Ee.name:var s=n.origin===d.MarkThreadReadOrigin.ThreadActivated?"read_thread":"mark_thread_as_read";i=r[n.threadId];_.logEvent(s,{stream:t,thread:i});break;case Ie.name:i=r[n];_.logEvent("mark_thread_as_unread",{stream:t,thread:i});break;case Ye.name:_.logEvent("subscribe",{stream:t});break;case Je.name:_.logEvent("unsubscribe",{stream:t})}}})),W((function(e,t){switch(e){case he.name:case be.name:case Ee.name:case Ie.name:case Fe.name:case Oe.name:return p.threadActionCompleted(e,t);case we.name:case Te.name:return p.commentActionCompleted(e,t)}})),b.dispatchMiddleware()),z=U("SetContext"),j=b.syncHandler(z),q=U("SetContextStatus"),G=b.syncHandler(q),K=x("ListComments"),Y=function(e,n){return void 0===e&&(e=!1),void 0===n&&(n=!0),function(o,p){return r.__awaiter(void 0,void 0,void 0,(function(){var v,S,b,A,T,M,E,C,I,F,P,D,x,U,L,V,N,W,H,B,z,j,q,X,Z,Q,J,$;return r.__generator(this,(function(r){switch(r.label){case 0:if(v=p(),!(S=f.getContext(v)))return[2];o({type:K.actionTypes.request}),b=S.stream,A=S.viewer,T=A?new s.Comments2Api(A.id,b):new s.Comments2LoggedOutApi(b),r.label=1;case 1:return r.trys.push([1,6,,7]),[4,T.listComments(e,f.getCursor(v))];case 2:if(M=r.sent(),E=M.bolt_info,C=M.cursor,I=M.status,F=M.supported_enhancements,P=M.threads,D=M.users,x=M.permissions,U=+new Date,L=f.getContextStatus(v),V=I[".tag"],N="enabled"===V||"readonly"===V,L===d.Comments2ContextStatus.Pending&&N&&(W=f.getData(v),H=W.perfEvents&&W.perfEvents.setContextTime||0,o(t.Actions.logSimplePerfEvent("initial_list_completed_ms",U-H))),B=p(),z=f.getContext(B),!g.isContextSame(z,S))return[2];if(x&&(o(ze({canEnable:x.can_enable_commenting})),o(Ke({canSubscribe:x.can_subscribe,isSubscribed:x.is_subscribed})),o(He(x.can_see_comment_editor)),o(N?w.enableMode(c.FileViewerMode.Commenting):w.disableMode(c.FileViewerMode.Commenting))),F&&(j=F.third_party_source,q=F.time_based_annotations,X=F.time_based_annotations_upsell_tooltip_variant,Z=(void 0===X?{".tag":"other"}:X)[".tag"],q&&o(xe()),"other"!==Z&&o(Le(Z)),j&&o(Ne(j[".tag"]))),Q=n?(te=/comment_id=(.*)/.exec(a.get_uri().getFragment()))?te[1]:void 0:void 0,L===d.Comments2ContextStatus.Pending)switch(I[".tag"]){case"disabled":null!=x&&x.can_enable_commenting,k(o),Q&&m.showErrorSnackbar({message:i.intl.formatMessage({id:"cwWK1c",defaultMessage:"Comments are disabled on this file."})});break;case"enabled":o(qe({listCompleteTime:U})),o(G(d.Comments2ContextStatus.FullyEnabled)),u.store.dispatch(y.setComments2ShownState({commentCount:P.filter((function(e){return!e.resolved})).length}));break;case"readonly":o(qe({listCompleteTime:U})),o(G(d.Comments2ContextStatus.ReadOnly)),u.store.dispatch(y.setComments2ShownState({commentCount:P.filter((function(e){return!e.resolved})).length}));break;case"comments1":o(G(d.Comments2ContextStatus.Comments1))}return f.isEnabled(v)||L===d.Comments2ContextStatus.Pending&&("enabled"===I[".tag"]||"readonly"===I[".tag"])?[4,o((ee=E,function(e){if(g.useBolt()){var r=h.debounce((function(){O(),e(Y(!1,!1))}),2e3);t.bolt.subscribe(ee,r,(function(){t.bolt.unsubscribe(),R((function(){e(Y(!1,!1))}))}))}}))]:[3,5];case 3:return r.sent(),J=l.streamToRevision(b),[4,o({type:K.actionTypes.success,payload:{authors:D,cursor:C,threads:P,currentRevision:J}})];case 4:r.sent(),Q&&o(t.Actions.activateComment(Q)),r.label=5;case 5:return[3,7];case 6:return($=r.sent())instanceof s.Comments2Error&&($.code===s.ErrorCode.FILE_NOT_FOUND?o(G(d.Comments2ContextStatus.Disabled)):A&&T instanceof s.Comments2Api&&_.logErrorEvent(($.message,": "+$.message),{stream:b})),o({type:K.actionTypes.error,error:$}),[3,7];case 7:return[2]}var ee,te}))}))}},X=U("ActivateThread"),Z=b.syncHandler(X),Q=L("DeactivateAllThreads"),J=b.syncHandler(Q),$=x("CheckOnboardingStatus"),ee=B($,(function(e,t){return t.api.checkOnboardingStatus()})),te=x("GetMediaFeatures"),re=B(te,(function(e,t){return t.api.getMediaFeatures()})),ne=x("GetFileMetadata"),ae=B(ne,(function(e,t){var r=e.fileId,n=e.linkUrl;return t.api.getFileMetadata(r,n)})),ie=x("GetStickers"),oe=B(ie,(function(e,t){return t.api.getStickers()})),se=U("HoverAnnotation"),ce=b.syncHandler(se),ue=U("FocusAnnotation"),le=b.syncHandler(ue),de=x("MarkOnboarded"),me=B(de,(function(e,t){return t.api.markHasOnboarded(e)})),ge=U("DismissOnboarding"),_e=b.syncHandler(ge),pe=U("MarkModalVariantShown"),fe=b.syncHandler(pe),he=x("CreateThread"),ve=B(he,(function(e,t){var r=e.annotation,n=(e.author,e.content),a=(e.guid,e.source),i=t.api,o=t.context.stream,s=l.iCommentContentToUserSubmittedComment({annotation:r,content:n,stream:o});return i.createThread(s,a)})),Se=H(x("LoggedOutCreateThread"),(function(e,t){var r=e.annotation,n=e.content,a=(e.guid,e.source),i=t.api,o=t.context.stream,s=l.iCommentContentToUserSubmittedComment({annotation:r,content:n,stream:o});return i.createThread(s,a)})),be=x("ReplyToThread"),ye=B(be,(function(e,t){e.author;var r=e.content,n=(e.guid,e.threadId),a=t.api,i=t.context.stream,o=l.iCommentContentToUserSubmittedComment({content:r,stream:i});return a.replyToThread(o,n)})),we=x("DeleteComment"),Ae=B(we,(function(e,t){var r=e.commentId;e.threadId;return t.api.deleteComment(r)})),Te=x("EditComment"),Me=B(Te,(function(e,t){var r=e.commentId,n=e.content,a=(e.threadId,t.api),i=t.context.stream,o=l.iCommentContentToUserSubmittedComment({content:n,stream:i});return a.editComment(r,o)})),Ee=x("MarkThreadRead"),Ce=B(Ee,(function(e,t){e.origin;var r=e.threadId;return t.api.markThreadRead(r)})),Ie=x("MarkThreadUnread"),ke=B(Ie,(function(e,t){return t.api.markThreadUnread(e)})),Fe=x("MarkThreadResolved"),Re=B(Fe,(function(e,t){var r=e.threadId;return t.api.markThreadResolved(r)})),Oe=x("MarkThreadUnresolved"),Pe=B(Oe,(function(e,t){return t.api.markThreadUnresolved(e)})),De=L("EnablePlayerIntegration"),xe=b.syncHandler(De),Ue=U("SetUpsellTooltipVariant"),Le=b.syncHandler(Ue),Ve=U("SetThirdPartySource"),Ne=b.syncHandler(Ve),We=U("SetCanSeeCommentEditor"),He=b.syncHandler(We),Be=U("RecordEnabledStatus"),ze=b.syncHandler(Be),je=U("SetPerfData"),qe=b.syncHandler(je),Ge=U("SetSubscriptionStatus"),Ke=b.syncHandler(Ge),Ye=x("Subscribe"),Xe=B(Ye,(function(e,t){return t.api.subscribe()})),Ze=L("ToggleShowResolved"),Qe=b.syncHandler(Ze),Je=x("Unsubscribe"),$e=B(Je,(function(e,t){return t.api.unsubscribe()})),et=U("UpdateDocumentCurrentPage"),tt=b.syncHandler(et),rt=U("UpdateEditorIsEmpty"),nt=b.syncHandler(rt),at=U("UpdatePlayerCurrentTime"),it=b.syncHandler(at),ot=U("DocMetadataLoad"),st=b.syncHandler(ot),ct=U("SetPendingNumberedAnnotation"),ut=b.syncHandler(ct),lt=L("ClearPendingNumberedAnnotation"),dt=b.syncHandler(lt),mt=L("SetPendingNumberedAnnotationMayBeOffscreen"),gt=b.syncHandler(mt),_t=L("RequestEditorFocus"),pt=b.syncHandler(_t),ft=L("FulfillEditorFocusRequest"),ht=b.syncHandler(ft),vt=U("TrackSidebarCommentsVisibility"),St=b.syncHandler(vt),bt=U("ResetStore"),yt=b.syncHandler(bt);function wt(e,t,n){var a=this;return function(){return r.__awaiter(a,void 0,void 0,(function(){var a,i;return r.__generator(this,(function(r){return t?(a=t.viewer,i=t.stream,(a?new s.Comments2Api(a.id,i):new s.Comments2LoggedOutApi(i)).logPerfEvent(e,n),[2]):[2]}))}))}}t.ActionTypes={SetContext:z,SetContextStatus:q,ActivateThread:X,CheckOnboardingStatus:$,CreateThread:he,DeactivateAllThreads:Q,DeleteComment:we,EditComment:Te,EnablePlayerIntegration:De,ListComments:K,HoverThread:se,FocusThread:ue,MarkOnboarded:de,DismissOnboarding:ge,GetMediaFeatures:te,GetFileMetadata:ne,GetStickers:ie,MarkModalVariantShown:pe,MarkThreadRead:Ee,MarkThreadResolved:Fe,MarkThreadUnread:Ie,MarkThreadUnresolved:Oe,RecordEnabledStatus:Be,ReplyToThread:be,SetCanSeeCommentEditor:We,SetPerfData:je,SetSubscriptionStatus:Ge,SetThirdPartySource:Ve,SetUpsellTooltipVariant:Ue,Subscribe:Ye,ToggleShowResolved:Ze,Unsubscribe:Je,UpdateDocumentCurrentPage:et,UpdateEditorIsEmpty:rt,UpdatePlayerCurrentTime:at,DocMetadataLoad:ot,SetPendingNumberedAnnotation:ct,ClearPendingNumberedAnnotation:lt,SetPendingNumberedAnnotationMayBeOffscreen:mt,RequestEditorFocus:_t,FulfillEditorFocusRequest:ft,TrackSidebarCommentsVisibility:vt,ResetStore:bt},t.Actions={setContextStatus:G,setFileContext:P,activateComment:function(e){return function(t,r){var n=f.getThreads(r()),a=g.findCommentThread(n,e);!a||a.comment.deleted?m.showErrorSnackbar({message:i.intl.formatMessage({id:"/83u+2",defaultMessage:"That comment has been deleted."})}):a.thread.resolved&&m.showErrorSnackbar({message:i.intl.formatMessage({id:"Uu2ETy",defaultMessage:"That comment has been resolved."})}),a&&t(T({thread:a.thread,pendingAnnotationInfo:g.getAnnotationInfoForThread(a.thread)}))}},activateThread:Z,activateThreadAndMarkAsRead:T,activateThreadByLayerClick:function(e,t){return function(r,n){var a=n();if(f.getIsComments2Ready(a)){var i=f.getDisplayedThreadsForLayer(a,e.page);r(J());var o=g.getThreadForNumberedAnnotationAtPoint(e,i,t);o&&r(T({thread:o,wasPreviewLayerClick:!0}))}}},activateThreadByMarkerClick:function(e){return function(t){return r.__awaiter(void 0,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return(n=u.store.getState().sidebar).open?[3,2]:[4,u.store.dispatch(y.open("annotation_select"))];case 1:r.sent(),r.label=2;case 2:return"comments"===n.activeTab?[3,4]:[4,u.store.dispatch(y.selectTab("comments"))];case 3:r.sent(),r.label=4;case 4:return t(T(e)),[2]}}))}))}},checkOnboardingStatus:ee,createThread:ve,loggedOutCreateThread:Se,deactivateAllThreads:J,deleteComment:Ae,disableCommenting:C,editComment:Me,enableCommenting:M,enablePlayerIntegration:xe,hoverThread:ce,focusThread:le,hoverThreadByLayer:function(e,t){return function(r,n){var a=n();if(f.getIsComments2Ready(a)){var i=f.getDisplayedThreadsForLayer(a,e.page),o=g.getThreadForNumberedAnnotationAtPoint(e,i,t);f.getHoverThreadId(a)!==(o&&o.id)&&r(ce(o&&o.id))}}},getMediaFeatures:re,getFileMetadata:ae,getStickers:oe,listComments:Y,markOnboarded:me,markOnboardedIfUnmarked:function(e){return function(t,r){f.getOnboardingVariants(r())[e]&&t(me(e))}},dismissOnboarding:_e,markModalVariantShown:fe,markThreadRead:Ce,markThreadResolved:Re,markThreadUnread:ke,markThreadUnresolved:Pe,recordEnabledStatus:ze,replyToThread:ye,setCanSeeCommentEditor:He,setPerfData:qe,setSubscriptionStatus:Ke,setThirdPartySource:Ne,setUpsellTooltipVariant:Le,subscribe:Xe,toggleShowResolved:Qe,unsubscribe:$e,updateDocumentCurrentPage:tt,updateEditorIsEmpty:nt,updatePlayerCurrentTime:it,setPendingNumberedAnnotation:ut,clearPendingNumberedAnnotation:dt,setPendingNumberedAnnotationMayBeOffscreen:gt,requestEditorFocus:pt,fulfillEditorFocusRequest:ht,trackSidebarCommentsVisibility:St,openVersionHistory:function(){return function(e,t){var r=t(),n=f.getViewerId(r),i=f.getFQPath(r);if(i&&n){var o=S.getFileHistoryUrl({fqPath:i,userId:n});a.redirect(o)}}},docMetadataLoad:st,logPerfEvent:function(e,t){var n=this;return function(a,i){return r.__awaiter(n,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){return n=f.getContext(i()),a(wt(e,n,t)),[2]}))}))}},logSimplePerfEvent:function(e,t){var n=this;return function(a,i){return r.__awaiter(n,void 0,void 0,(function(){var n,a;return r.__generator(this,(function(r){return n=i(),(a=f.getContext(n))&&a.viewer&&new s.Comments2Api(a.viewer.id,a.stream).logSimplePerfEvent(e,t),[2]}))}))}},resetStore:yt}})),define("modules/clean/react/watermarking/watermarking_layer",["require","exports","tslib","react","react-redux","modules/clean/react/css","modules/clean/react/file_viewer/data/actions","modules/clean/react/watermarking/drawing","modules/clean/react/watermarking/selectors","modules/clean/react/watermarking/utils","modules/clean/react/watermarking/types"],(function(e,t,r,n,a,i,o,s,c,u,l){"use strict";function d(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var r=t.getContext("2d");if(!r)return 0;r.drawImage(e,0,0);for(var n,a,i,o=r.getImageData(0,0,t.width,t.height).data,s=0,c=0,u=o.length;c<u;c+=4)n=o[c],a=o[c+1],i=o[c+2],s+=Math.floor((n+a+i)/3);return Math.floor(s/(e.width*e.height))}Object.defineProperty(t,"__esModule",{value:!0}),t.WatermarkingLayer=t._WatermarkingLayer=t.ConnectedWatermarkingLayer=void 0;var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.updateWatermarkColor=function(){var e=t.props,r=e.thumbUrl,n=e.watermark;r?(t.img=new Image,t.img.crossOrigin="use-credentials",t.img.onload=function(){var e=d(t.img)<127?"white":"black";t.setTextWatermark({color:e})},t.img.src=r):t.setTextWatermark({color:n.textWatermarkingOptions.color})},t.updateWatermarkFontSize=function(){var e=t.props,r=e.pageDimensions,n=e.watermark;if(r){var a=n.textWatermarkingOptions.size,i=Math.floor((r.width+r.height)/2),o=Math.floor(i/200),s=Math.floor(i/5),c=a!==u.DEFAULT_WATERMARKING_STATE.textWatermarkingOptions.size&&o<a&&a<s?a:Math.floor(i/40);t.setTextWatermark({size:c,minSize:o,maxSize:s})}},t.canvasRef=function(e){t.canvas=e},t.redraw=function(){var e=t.props,r=e.tilingFunc,n=e.watermark;if(r&&t.canvas&&n){var a=t.canvas.getContext("2d");if(a){var i=l.getWatermarkingOptions(n),o=t.getCanvasSize(),c=o.canvasWidth,d=o.canvasHeight,m=o.scale;if(a.clearRect(0,0,c,d),i.position!==l.WatermarkPosition.REPEAT){var g,_=i.angle/180*Math.PI;if(n.mode===l.WatermarkingMode.TEXT){if(!(p=n.textWatermarkingOptions).text)return;g=s.drawTextTile(p.text,p.size*m,p.fontFamily,p.color,p.opacity/100,_).canvas}else{var p;if(!(p=n.imageWatermarkingOptions).image)return;g=s.drawImageTile(p.image,p.size*m,p.opacity/100,_).canvas}if(g){var f=i.marginX*m,h=i.marginY*m,v=f,S=h;switch(i.position){case l.WatermarkPosition.CENTER:v=(c-g.width)/2,S=(d-g.height)/2;break;case l.WatermarkPosition.NORTHEAST:v=c-g.width-f;break;case l.WatermarkPosition.SOUTHWEST:S=d-g.height-h;break;case l.WatermarkPosition.SOUTHEAST:v=c-g.width-f,S=d-g.height-h}a.drawImage(g,v,S)}}else{var b=void 0;try{b=r(m)}catch(e){if(e.message===u.WatermarkingError.TILE_NO_INPUT)return;throw e}for(var y=0,w=0,A=(b.startY+w)%b.distanceY-b.height;A<d;A+=b.distanceY){for(var T=(b.startX+y)%b.distanceX-b.width;T<c;T+=b.distanceX)a.drawImage(b.canvas,T,A);y+=b.offsetXPerRow,w+=b.offsetYPerCol}}}}},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.updateWatermarkColor(),this.updateWatermarkFontSize(),this.redraw(),this.props.pageDimensions&&this.props.setPageDimensions(this.props.pageDimensions)},t.prototype.componentDidUpdate=function(e){this.props.thumbUrl!==e.thumbUrl&&this.updateWatermarkColor(),this.redraw()},t.prototype.setTextWatermark=function(e){var t=this.props,r=t.updateWatermarkOptions;t.watermark.mode===l.WatermarkingMode.TEXT&&r({textWatermarkingOptions:e})},t.prototype.getCanvasSize=function(){var e=this.props.layerSize.width,t=this.props.pageDimensions||this.props.layerSize,r=t.width,n=t.height,a=e/r;if(this.props.watermark){var i=l.getWatermarkingOptions(this.props.watermark);a=Math.min(a,i.scale)}return{canvasWidth:Math.round(r*a),canvasHeight:Math.round(n*a),scale:a}},t.prototype.render=function(){var e=this.props,t=e.watermark,r=e.tilingFunc;if(!t||!r)return null;var a=this.props.layerSize,i=a.width,o=a.height,s=this.getCanvasSize(),c=s.canvasWidth,u=s.canvasHeight,l={width:i+"px",height:o+"px"};return n.default.createElement("canvas",{ref:this.canvasRef,className:"fv-watermarking-layer",style:l,width:c,height:u})},t})((n=r.__importDefault(n)).default.PureComponent);t._WatermarkingLayer=m;var g=a.connect((function(e){return{watermark:c.getWatermarkState(e),tilingFunc:c.getWatermarkTilingFunc(e)}}),{updateWatermarkOptions:o.updateWatermarkOptions,setPageDimensions:o.setPageDimensions});t.ConnectedWatermarkingLayer=g(m);var _=i.requireCssWithComponent(t.ConnectedWatermarkingLayer,["/static/css/file_viewer/watermarking_layer-vflNek1am.css"]);t.WatermarkingLayer=_})),define("modules/clean/react/file_sidebar/file_sidebar_logger",["require","exports","tslib","modules/clean/deprecated_ajax/ajax_jquery","modules/clean/react/file_viewer/models"],(function(e,t,r,n,a){"use strict";function i(e,t){var r=a.FileViewerSession.currentSession,i=a.FilePreviewSession.currentSession;if(i&&r){var o={event_name:e,file_viewer_session_id:r.id,file_preview_session_id:i.id,file_ns_id:i.file.ns_id,file_sjid:i.file.sjid,extra:JSON.stringify(t)};n.SilentBackgroundRequest({url:"/log/file_sidebar",data:o})}}Object.defineProperty(t,"__esModule",{value:!0}),t.logFileViewActivityCardExpanded=t.logActivityStreamInteractivity=t.logSidebarClosed=t.logSidebarOpened=t.logSidebarTabSelected=void 0,n=r.__importStar(n),t.logSidebarTabSelected=function(e){i("sidebar_tab_selected",e)},t.logSidebarOpened=function(e){i("sidebar_opened",e)},t.logSidebarClosed=function(e){i("sidebar_closed",e)},t.logActivityStreamInteractivity=function(e){i("activity_stream_interactivity",e)},t.logFileViewActivityCardExpanded=function(e){i("file_view_activity_expanded",e)}})),define("modules/clean/open_in_app/actions",["require","exports","tslib","modules/clean/open_in_app/types","modules/clean/open_in_mobile_app"],(function(e,t,r,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cleanUp=t.openImmediately=t.openInApp=void 0,a=r.__importDefault(a),t.openInApp=function(e,t){var r,i=t.onAppNeeded,o=t.onAppInstalled;n.areUrlsIOS(e)?a.default.open_ios(e.iOSAppUrl,e.iOSAppStoreUrl,!(r=(navigator.userAgent||"").match(/OS (\d+)_(\d+)_?(\d+)?/))||parseInt(r[1],10)>=9,i,o):n.areUrlsAndroid(e)&&a.default.open_android_intent(e.androidAppUrl)},t.openImmediately=function(e){var t;if(n.areUrlsIOS(e))t=e.iOSAppUrl;else{if(!n.areUrlsAndroid(e))return;t=e.androidAppUrl}var r=document.createElement("iframe");r.setAttribute("class","open-in-app-transport"),r.setAttribute("src",t),r.setAttribute("style","display: none"),document.body.appendChild(r)},t.cleanUp=function(){a.default.cleanup()}})),define("modules/clean/open_in_mobile_app",["require","exports","tslib","jquery","modules/clean/analytics","modules/core/exception","modules/core/i18n","spectrum-sharing/utils/sharing_constants"],(function(e,t,r,n,a,i,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),a=r.__importStar(a);var c=(function(){function e(){}return e.initClass=function(){var e=this;this.vischange_listener=null,this.open_app_mode=!0,this.try_open_ios_9=function(t,r,n,a){return void 0===n&&(n=function(){}),void 0===a&&(a=function(){}),e.vischange_listener||(e.vischange_listener=function(t){return e.open_app_mode=!0,a()},document.addEventListener("visibilitychange",e.vischange_listener)),e.open_app_mode?(e.open_app_mode=!1,e._onOpenLoggingHandler(),n(),window.location=t):(e._onInstallLoggingHandler(),window.location=r)},this.fallback_will_launch=!1,this.try_open=function(t,r,i){if(e._onOpenLoggingHandler(),!e.fallback_will_launch){var o=n.default("body"),c=!1,u=function(e){return c=!0};document.addEventListener("visibilitychange",u);var l,d=!1,m=function(e){return d=!0};window.addEventListener("pagehide",m),null!=i&&a.ShareTibEventLogger.log_unauth("CLICK_MOBILE_OPEN",s.SHARE_ACTION_ORIGIN_TYPE.WEB_MOBILE,{scl_url:i}),l=n.default("<iframe />",{src:t,style:"display: none;"}),o.append(l);var g=Date.now();return setTimeout((function(){if(e.fallback_will_launch=!1,document.removeEventListener("visibilitychange",u),window.removeEventListener("pagehide",m),!d&&!c&&Date.now()<g+4700)return null!=i&&a.ShareTibEventLogger.log_unauth("CLICK_MOBILE_INSTALL",s.SHARE_ACTION_ORIGIN_TYPE.WEB_MOBILE,{scl_url:i}),window.location.replace(r)}),3200),e.fallback_will_launch=!0}}},e._onOpenLoggingHandler=function(){},e._onInstallLoggingHandler=function(){},e.registerLoggingHandlers=function(e,t){return this._onOpenLoggingHandler=e,this._onInstallLoggingHandler=t},e.open_on_click=function(e,t,r,a,i,s,c){var u=this;void 0===s&&(s=null);return n.default(r).on("click",(function(r){if(r.preventDefault(),c)return u.open_android_intent(c);if(i){a||(a=n.default("<div/>"));var l=a.text();return u.try_open_ios_9(e,t,(function(){return a.text(o.intl.formatMessage({id:"RgopQo",defaultMessage:"Install app?"}))}),(function(){return a.text(l)}))}return u.try_open(e,t,s)}))},e.open_ios=function(e,t,r,n,a){return void 0===n&&(n=function(){}),void 0===a&&(a=function(){}),r?this.try_open_ios_9(e,t,n,a):this.try_open(e,t)},e.open_android_intent=function(e){return i.assert(e&&e.startsWith("intent://www.dropbox.com/sm/launch_intent_or_fallback_page"),"intentUrl must use intent:// protocol"),this._onOpenLoggingHandler&&this._onOpenLoggingHandler(),window.location.href=e},e.redirect_on_load=function(e,t){return this.try_open(e,t)},e.cleanup=function(){if(this.vischange_listener)return document.removeEventListener("visibilitychange",this.vischange_listener)},e})();c.initClass(),t.default=c})),define("modules/clean/react/file_viewer/controller_mode",["require","exports","modules/clean/api_v2/noauth_client","modules/clean/api_v2/user_client"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchControllerMode=void 0,t.fetchControllerMode=function(e,t){return null!=t?(function(e,t){return(new n.UserApiV2Client).ns("file_viewer").rpc("get_mode",e,{subjectUserId:t.id})})(e,t):(function(e){return(new r.NoAuthApiV2Client).ns("file_viewer").rpc("logged_out/get_mode",e,{})})(e)}})),define("modules/clean/react/file_viewer/data/actions",["require","exports","tslib","modules/clean/deprecated_ajax/ajax_jquery","modules/clean/react/file_viewer/constants","modules/clean/file_store/actions","modules/clean/previews/data/actions","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/data/selectors","modules/clean/file_store/utils","modules/clean/react/file_viewer/data/types","modules/clean/previews/data/util","modules/clean/react/file_viewer/constants","modules/clean/downloads","modules/core/uri","modules/core/browser","modules/clean/react/file_viewer/controller_mode","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/watermarking/utils","file-viewer/core/index","modules/clean/react/workflows/markup/fabric","modules/clean/react/workflows/markup/selectors","modules/clean/react/file_viewer/prompt/campaign_api","modules/clean/react/size_class/constants","modules/clean/react/watermarking/selectors","modules/clean/react/file_viewer/ml_experiment","modules/clean/react/branding/api"],(function(e,t,r,n,a,i,o,s,c,u,l,d,m,g,_,p,f,h,v,S,b,y,w,A,T,M,E,C){"use strict";function I(e){return{type:l.Actions.OpenFile,payload:{fileId:e}}}function k(e){return function(t,r){var n,a=((n={})[b.FileViewerMode.Default]=H,n[b.FileViewerMode.Documentation]=z,n[b.FileViewerMode.Commenting]=j,n[b.FileViewerMode.Watermarking]=q,n[b.FileViewerMode.Zoom]=G,n[b.FileViewerMode.Slack]=K,n[b.FileViewerMode.Markup]=Y,n[b.FileViewerMode.Plugins]=Z,n[b.FileViewerMode.HelloSign]=Q,n[b.FileViewerMode.ProAnalytics]=X,n);a[e]&&a[e](t,r)}}function F(e){return v.filePreviewEventEmitter.emit(m.EventType.SidebarModeSelected,h.FilePreviewSession.currentSession,{selected_mode:e}),{type:l.Actions.UpdateMode,payload:{mode:e}}}function R(e){return function(t,r){var n=c.getCurrentFileId(r());n&&t((function(e,t){return{type:l.Actions.UpdateRenderStatus,payload:{fileId:e,renderStatus:t}}})(n,e))}}function O(e){return v.filePreviewEventEmitter.emit(m.EventType.SidebarPaneSelected,h.FilePreviewSession.currentSession,{selected_pane:e}),{type:l.Actions.PushSidebarPane,payload:{paneId:e}}}function P(){return{type:l.Actions.ResetSidebarPaneStack}}function D(){return{type:l.Actions.ResetSelectedSidebarControlId}}function x(e){return{type:l.Actions.SetSelectedSidebarControlId,payload:{controlId:e}}}function U(e){var t=e===b.SidebarVisibility.Open?m.EventType.SidebarOpened:m.EventType.SidebarClosed;return v.filePreviewEventEmitter.emit(t,h.FilePreviewSession.currentSession),{type:l.Actions.SetSidebarVisibility,payload:{visibility:e}}}function L(e){return function(t,r){t({type:l.Actions.UpdateWatermarkOptions,payload:{options:e}}),S.setLocalStorageWatermarkingState(c.getCurrentUser(r()),M.getWatermarkState(r()))}}function V(e){return function(t,r){t({type:l.Actions.SwitchWatermarkingMode,payload:{mode:e}}),S.setLocalStorageWatermarkingState(c.getCurrentUser(r()),M.getWatermarkState(r()))}}function N(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var a,i;return r.__generator(this,(function(o){switch(o.label){case 0:return[4,S.getUserMetadataTextWatermarkingState(e)];case 1:return a=o.sent(),[4,S.getLocalStorageWatermarkingState(e)];case 2:return(i=o.sent())?(L({textWatermarkingOptions:r.__assign(r.__assign({},i.textWatermarkingOptions),a),imageWatermarkingOptions:i.imageWatermarkingOptions})(t,n),V(i.mode)(t,n)):a?L({textWatermarkingOptions:a})(t,n):L({textWatermarkingOptions:{text:S.getDefaultText(e)}})(t,n),[2]}}))}))}function W(e){return{type:l.Actions.SetTrialMode,payload:{isTrialMode:e}}}function H(e,t){var r=t(),n=c.getMode(r);e(W(!1)),e(D()),n!==b.FileViewerMode.Default&&e(F(b.FileViewerMode.Default))}function B(e,t,r,n){return function(a,i){var o=i(),s=c.getSidebar(o).visibility,u=c.getMode(o);s===b.SidebarVisibility.Closed&&a(U(b.SidebarVisibility.Open)),u!==e&&(a(W(!!n&&n(o))),a(x(t)),a(P()),a(O(r)),a(F(e)))}}Object.defineProperty(t,"__esModule",{value:!0}),t.overflowZoomOff=t.overflowZoomOn=t.loadWatermarkingStateFromStorage=t.registerUser=t.pageUp=t.pageDown=t.updateCurrentPageIndex=t.fetchDocClassificationAction=t.fetchBestCampaignsAction=t.fetchActiveUserBrandingInfoAction=t.fetchControllerModeAction=t.disableForceHideToolbar=t.forceHideToolbar=t.resetFileViewerStore=t.setMediaPaused=t.setMediaPlaying=t.pendingFileUploaded=t.download=t.saveForwardRevision=t.restoreRevisionAction=t.switchRevisionAction=t.resetMarkupState=t.setMarkupFormatSubmenu=t.setMarkupFill=t.setMarkupStroke=t.setMarkupDrawingMode=t.updateMarkupCanvasScale=t.setMarkupCanvas=t.switchWatermarkingMode=t.updateWatermarkOptions=t.setPageDimensions=t.setSidebarVisibility=t.setSelectedSidebarControlId=t.resetSelectedSidebarControlId=t.resetSidebarPaneStack=t.popSidebarPane=t.pushSidebarPane=t.fetchShowOverQuotaUpsell=t.setRenderStatusSuccessForCurrentFile=t.setRenderStatusForCurrentFile=t.openFile=t.updateMode=t.enableMode=t.disableMode=t.changeMode=t.closeFile=t.openFileById=t.dismissAppDownloadInterstitial=t.closeSidebar=t.openSidebar=t.closeFullScreen=t.openFullScreen=void 0,n=r.__importStar(n),g=r.__importStar(g),p=r.__importStar(p),t.openFullScreen=function(){return{type:l.Actions.OpenFullScreen}},t.closeFullScreen=function(){return{type:l.Actions.CloseFullScreen}},t.openSidebar=function(e,t){return void 0===e&&(e=a.DocType.default),function(r){r({type:l.Actions.OpenSidebar,payload:{type:e}}),s.logUserAction(a.UserAction.ToggleSidebarOn,t)}},t.closeSidebar=function(e,t){return void 0===e&&(e=a.DocType.default),function(r){r({type:l.Actions.CloseSidebar,payload:{type:e}}),s.logUserAction(a.UserAction.ToggleSidebarOff,t)}},t.dismissAppDownloadInterstitial=function(){return{type:l.Actions.DismissAppDownloadInterstitial}},t.openFileById=I,t.closeFile=function(){return{type:l.Actions.CloseFile}},t.changeMode=k,t.disableMode=function(e){return{type:l.Actions.DisableMode,payload:{mode:e}}},t.enableMode=function(e){return{type:l.Actions.EnableMode,payload:{mode:e}}},t.updateMode=F,t.openFile=function(e){var t=this;return function(n,a){return r.__awaiter(t,void 0,void 0,(function(){var t,s;return r.__generator(this,(function(r){return t=u.getFileStoreId(e),s=i.putFile(e),n(s),!d.previewDataPresentForFile(a(),e)&&!d.previewDataInFlight(a(),e)&&(s.payload.file.preview?n(o.populateFilesPreviewData([s.payload.file])):n(o.fetchPreviewData([s.payload.file]))),n(I(t)),[2]}))}))}},t.setRenderStatusForCurrentFile=R,t.setRenderStatusSuccessForCurrentFile=function(){return R(m.PreviewRenderStatus.Succeeded)},t.fetchShowOverQuotaUpsell=function(e){return function(t,r){e&&void 0===c.getShowOverQuotaUpsell(r())&&n.SilentBackgroundRequest({url:"/should_show_file_preview_upsell",data:{_subject_uid:e.id},success:function(e){try{var r=JSON.parse(e);r&&t((n=r.shouldShowFilePreviewUpsell,{type:l.Actions.SetShowOverQuotaUpsell,payload:n}))}catch(e){}var n}})}},t.pushSidebarPane=O,t.popSidebarPane=function(){return{type:l.Actions.PopSidebarPane}},t.resetSidebarPaneStack=P,t.resetSelectedSidebarControlId=D,t.setSelectedSidebarControlId=x,t.setSidebarVisibility=U,t.setPageDimensions=function(e){return{type:l.Actions.SetPageDimensions,payload:{pageDimensions:e}}},t.updateWatermarkOptions=L,t.switchWatermarkingMode=V,t.setMarkupCanvas=function(e,t,r){return{type:l.Actions.SetMarkupCanvas,payload:{page:e,fabric:t,scale:r}}},t.updateMarkupCanvasScale=function(e,t){return{type:l.Actions.UpdateMarkupCanvasScale,payload:{page:e,scale:t}}},t.setMarkupDrawingMode=function(e){return function(t,r){t({type:l.Actions.SetMarkupDrawingMode,payload:{isDrawingMode:e}}),y.setDrawingMode(w.getMarkupState(r()),e)}},t.setMarkupStroke=function(e){return function(t){t({type:l.Actions.SetMarkupStroke,payload:{color:e}}),y.setBaseBrushColor(e)}},t.setMarkupFill=function(e){return{type:l.Actions.SetMarkupFill,payload:{color:e}}},t.setMarkupFormatSubmenu=function(e){return{type:l.Actions.SetMarkupSubmenuType,payload:{formatSubmenu:e}}},t.resetMarkupState=function(){return function(e,t){y.disposeCanvas(w.getMarkupState(t())),e({type:l.Actions.ResetMarkupState})}},t.switchRevisionAction=function(e){return function(t){e.preview&&t(o.overridePreviewForComments(e,e.preview)),t({type:l.Actions.SwitchRevision,payload:{file:e}})}},t.restoreRevisionAction=function(){return function(e,t){var r=c.getActiveFile(t());r&&e(o.clearCommentsPreviewOverride(r)),e({type:l.Actions.RestoreRevision})}},t.saveForwardRevision=function(e){return function(t){t(i.putFile(e,e.revision_id)),e.preview&&t(o.overridePreviewForComments(e,e.preview)),t({type:l.Actions.SaveForwardRevision,payload:{revisionKey:e.revision_id}})}},t.download=function(e){var t=_.URI.parse(e.href);t.updateQuery({dl:"1"}),g.get({url:t.toString()})},t.pendingFileUploaded=function(){p.reload(!0)},t.setMediaPlaying=function(){return function(e){e({type:l.Actions.PlayMedia})}},t.setMediaPaused=function(){return function(e){e({type:l.Actions.PauseMedia})}},t.resetFileViewerStore=function(){return function(e){e({type:l.Actions.ResetStore})}},t.forceHideToolbar=function(){return{type:l.Actions.ForceHideToolbar}},t.disableForceHideToolbar=function(){return{type:l.Actions.DisableForceHideToolbar}},t.fetchControllerModeAction=function(e,t,n){var a=this;return function(i,o){return r.__awaiter(a,void 0,void 0,(function(){var a,s,u,d;return r.__generator(this,(function(r){switch(r.label){case 0:i({type:l.Actions.FetchControllerModeRequest}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,f.fetchControllerMode(e,t)];case 2:return a=r.sent().mode,v.filePreviewEventEmitter.emit(m.EventType.FilePreviewModeDetermined,h.FilePreviewSession.currentSession,{mode:a}),n===T.SizeClass.Small||n===T.SizeClass.Medium?(i(x(b.SidebarControlId.Documentation)),i(O(b.SidebarPaneId.Documentation)),i(F(b.FileViewerMode.Documentation)),[2]):(s=(function(e){var t=b.FileViewerMode.Default;if(e)switch(e[".tag"]){case"commenting_mode":t=b.FileViewerMode.Commenting;break;case"documentation_mode":t=b.FileViewerMode.Documentation;break;case"other":t=b.FileViewerMode.Default}return t})(a),(u=c.getMode(o()))&&u!==b.FileViewerMode.Default||i(k(s)),[3,4]);case 3:return d=r.sent(),i({type:l.Actions.FetchControllerModeError,payload:d}),[3,4];case 4:return[2]}}))}))}},t.fetchActiveUserBrandingInfoAction=function(e){var t=this;return function(n,a){return r.__awaiter(t,void 0,void 0,(function(){var t,a,i,o,s,c;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Promise.all([C.getLogo(e.id),C.getName(e.id)])];case 1:return t=r.sent(),a=t[0],i=t[1],o=null,"image"===(null==(s=null===(c=null==a?void 0:a.graphic)||void 0===c?void 0:c.value)?void 0:s[".tag"])&&s.original_url&&(o=s.original_url),n({type:l.Actions.SetActiveUserBrandingInfo,payload:{activeUserBrandingInfo:{logoUrl:o,organizationName:i}}}),[3,3];case 2:return r.sent(),[3,3];case 3:return[2]}}))}))}},t.fetchBestCampaignsAction=function(e,t){var n=this;return function(a,i){return r.__awaiter(n,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,A.fetchBestCampaigns(e.id,t)];case 1:return n=r.sent().campaigns,a({type:l.Actions.SetBestCampaign,payload:{campaign:n[0]}}),[2]}}))}))}},t.fetchDocClassificationAction=function(e,t){var n=this;return function(a,i){return r.__awaiter(n,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,E.fetchDocClassification(e,t)];case 1:return n=r.sent().predicted_types,a({type:l.Actions.SetDocClassification,payload:{docClassification:{predicted_types:n},fileId:t}}),[2]}}))}))}},t.updateCurrentPageIndex=function(e){return{type:l.Actions.UpdateCurrentPageIndex,payload:{currentPageIndex:e}}},t.pageDown=function(){return{type:l.Actions.PageDown}},t.pageUp=function(){return{type:l.Actions.PageUp}},t.registerUser=function(e){return function(t,r){t({type:l.Actions.RegisterUser,payload:{user:e}}),N(e,t,r)}},t.loadWatermarkingStateFromStorage=N;var z=B(b.FileViewerMode.Documentation,b.SidebarControlId.Documentation,b.SidebarPaneId.Documentation),j=B(b.FileViewerMode.Commenting,b.SidebarControlId.Comments,b.SidebarPaneId.Comments),q=B(b.FileViewerMode.Watermarking,b.SidebarControlId.Watermarking,b.SidebarPaneId.Watermarking,(function(e){return S.allowWatermarkTrial(c.getCurrentUser(e))})),G=B(b.FileViewerMode.Zoom,b.SidebarControlId.Zoom,b.SidebarPaneId.Zoom),K=B(b.FileViewerMode.Slack,b.SidebarControlId.Slack,b.SidebarPaneId.SlackHome),Y=B(b.FileViewerMode.Markup,b.SidebarControlId.Markup,b.SidebarPaneId.Markup),X=B(b.FileViewerMode.ProAnalytics,b.SidebarControlId.ProAnalytics,b.SidebarPaneId.ProAnalytics),Z=function(){},Q=function(){};t.overflowZoomOn=function(){return{type:l.Actions.OverflowZoomOn}},t.overflowZoomOff=function(){return{type:l.Actions.OverflowZoomOff}}})),define("modules/clean/react/file_viewer/data/reducer",["require","exports","tslib","modules/clean/react/file_viewer/data/types","modules/clean/react/watermarking/utils","modules/clean/react/file_viewer/constants","file-viewer/core/index","modules/clean/react/workflows/markup/utils"],(function(e,t,r,n,a,i,o,s){"use strict";var c;Object.defineProperty(t,"__esModule",{value:!0}),t.fileViewerReducer=t.defaultState=void 0,t.defaultState={currentFileId:void 0,currentPageIndex:0,fileRevision:void 0,latestFileId:void 0,forceHideToolbar:!1,isFullScreen:!1,isSidebarOpen:(c={},c[i.DocType.ppt]=!0,c[i.DocType.pdf]=!1,c),mode:o.FileViewerMode.Default,disabledModes:{},renderStatuses:{},showOverQuotaUpsell:void 0,sidebar:{visibility:o.SidebarVisibility.Closed,paneStack:[],selectedControlId:void 0},watermark:a.DEFAULT_WATERMARKING_STATE,markup:s.DEFAULT_MARKUP_STATE,campaign:void 0,activeUserBrandingInfo:void 0,overflowZoom:!1,docClassifications:{},docClassificationVariant:null},t.fileViewerReducer=function(e,a){var i,c,u,l,d,m,g,_;switch(void 0===e&&(e=t.defaultState),a.type){case n.Actions.CloseFile:return r.__assign(r.__assign({},e),{currentFileId:void 0,fileRevision:void 0,latestFileId:void 0});case n.Actions.OpenFile:var p=a.payload;return r.__assign(r.__assign({},e),{currentFileId:p.fileId,fileRevision:void 0,latestFileId:void 0});case n.Actions.SwitchRevision:p=a.payload;return r.__assign(r.__assign({},e),{fileRevision:p.file});case n.Actions.RestoreRevision:return r.__assign(r.__assign({},e),{fileRevision:void 0,currentFileId:e.latestFileId||e.currentFileId,latestFileId:void 0});case n.Actions.SetPageDimensions:var f=a.payload.pageDimensions;return r.__assign(r.__assign({},e),{pageDimensions:f});case n.Actions.UpdateWatermarkOptions:var h=a.payload.options;return r.__assign(r.__assign({},e),{watermark:r.__assign(r.__assign({},e.watermark),{textWatermarkingOptions:r.__assign(r.__assign({},e.watermark.textWatermarkingOptions),h.textWatermarkingOptions),imageWatermarkingOptions:r.__assign(r.__assign({},e.watermark.imageWatermarkingOptions),h.imageWatermarkingOptions)})});case n.Actions.SwitchWatermarkingMode:var v=a.payload.mode;return r.__assign(r.__assign({},e),{watermark:r.__assign(r.__assign({},e.watermark),{mode:v})});case n.Actions.SetMarkupCanvas:var S=a.payload,b=S.page,y=S.fabric,w=S.scale;return r.__assign(r.__assign({},e),{markup:r.__assign(r.__assign({},e.markup),(i={},i[b]={scale:w,fabric:y},i))});case n.Actions.UpdateMarkupCanvasScale:var A=a.payload;b=A.page,w=A.scale;return r.__assign(r.__assign({},e),{markup:r.__assign(r.__assign({},e.markup),(c={},c[b]=r.__assign(r.__assign({},e.markup[b]),{scale:w}),c))});case n.Actions.ResetMarkupState:return r.__assign(r.__assign({},e),{markup:s.DEFAULT_MARKUP_STATE});case n.Actions.SetMarkupDrawingMode:var T=a.payload.isDrawingMode;return r.__assign(r.__assign({},e),{markup:r.__assign(r.__assign({},e.markup),{isDrawingMode:T})});case n.Actions.SetMarkupFill:var M=a.payload.color;return r.__assign(r.__assign({},e),{markup:r.__assign(r.__assign({},e.markup),{fillColor:M})});case n.Actions.SetMarkupStroke:M=a.payload.color;return r.__assign(r.__assign({},e),{markup:r.__assign(r.__assign({},e.markup),{strokeColor:M})});case n.Actions.SetMarkupSubmenuType:var E=a.payload.formatSubmenu;return r.__assign(r.__assign({},e),{markup:r.__assign(r.__assign({},e.markup),{formatSubmenu:E})});case n.Actions.SaveForwardRevision:p=a.payload;return r.__assign(r.__assign({},e),{latestFileId:p.revisionKey});case n.Actions.UpdateMode:p=a.payload;return r.__assign(r.__assign({},e),{mode:p.mode});case n.Actions.DisableMode:p=a.payload;return r.__assign(r.__assign({},e),{disabledModes:r.__assign(r.__assign({},e.disabledModes),(u={},u[p.mode]=!0,u))});case n.Actions.EnableMode:p=a.payload;return r.__assign(r.__assign({},e),{disabledModes:r.__assign(r.__assign({},e.disabledModes),(l={},l[p.mode]=!1,l))});case n.Actions.OpenFullScreen:return r.__assign(r.__assign({},e),{isFullScreen:!0});case n.Actions.CloseFullScreen:return r.__assign(r.__assign({},e),{isFullScreen:!1});case n.Actions.OpenSidebar:p=a.payload;return r.__assign(r.__assign({},e),{isSidebarOpen:r.__assign(r.__assign({},e.isSidebarOpen),(d={},d[p.type]=!0,d))});case n.Actions.CloseSidebar:p=a.payload;return r.__assign(r.__assign({},e),{isSidebarOpen:r.__assign(r.__assign({},e.isSidebarOpen),(m={},m[p.type]=!1,m))});case n.Actions.DismissAppDownloadInterstitial:return r.__assign(r.__assign({},e),{appDownloadInterstitialDismissed:!0});case n.Actions.SetShowOverQuotaUpsell:p=a.payload;return r.__assign(r.__assign({},e),{showOverQuotaUpsell:p});case n.Actions.UpdateRenderStatus:p=a.payload;return r.__assign(r.__assign({},e),{renderStatuses:r.__assign(r.__assign({},e.renderStatuses),(g={},g[p.fileId]=p.renderStatus,g))});case n.Actions.PlayMedia:return r.__assign(r.__assign({},e),{isMediaPlaying:!0});case n.Actions.PauseMedia:return r.__assign(r.__assign({},e),{isMediaPlaying:!1,pauseCount:e.pauseCount?e.pauseCount+1:1});case n.Actions.ResetStore:return t.defaultState;case n.Actions.UpdateCurrentPageIndex:p=a.payload;return r.__assign(r.__assign({},e),{currentPageIndex:p.currentPageIndex});case n.Actions.ForceHideToolbar:return r.__assign(r.__assign({},e),{forceHideToolbar:!0});case n.Actions.DisableForceHideToolbar:return r.__assign(r.__assign({},e),{forceHideToolbar:!1});case n.Actions.PopSidebarPane:return e.sidebar.paneStack.length<1?e:r.__assign(r.__assign({},e),{sidebar:r.__assign(r.__assign({},e.sidebar),{paneStack:e.sidebar.paneStack.slice(0,-1)})});case n.Actions.PushSidebarPane:p=a.payload;return e.sidebar.paneStack.includes(p.paneId)?e:r.__assign(r.__assign({},e),{sidebar:r.__assign(r.__assign({},e.sidebar),{paneStack:r.__spreadArrays(e.sidebar.paneStack,[p.paneId])})});case n.Actions.SetSelectedSidebarControlId:p=a.payload;return r.__assign(r.__assign({},e),{sidebar:r.__assign(r.__assign({},e.sidebar),{selectedControlId:p.controlId})});case n.Actions.ResetSidebarPaneStack:return r.__assign(r.__assign({},e),{sidebar:r.__assign(r.__assign({},e.sidebar),{paneStack:[]})});case n.Actions.ResetSelectedSidebarControlId:return r.__assign(r.__assign({},e),{sidebar:r.__assign(r.__assign({},e.sidebar),{selectedControlId:void 0})});case n.Actions.SetSidebarVisibility:p=a.payload;return r.__assign(r.__assign({},e),{sidebar:r.__assign(r.__assign({},e.sidebar),{visibility:p.visibility})});case n.Actions.FetchControllerModeError:return r.__assign(r.__assign({},e),{mode:e.sidebar.visibility===o.SidebarVisibility.Closed?o.FileViewerMode.Default:o.FileViewerMode.Commenting});case n.Actions.SetActiveUserBrandingInfo:p=a.payload;return r.__assign(r.__assign({},e),{activeUserBrandingInfo:p.activeUserBrandingInfo});case n.Actions.SetBestCampaign:p=a.payload;return r.__assign(r.__assign({},e),{campaign:p.campaign});case n.Actions.SetDocClassification:p=a.payload;return r.__assign(r.__assign({},e),{docClassifications:r.__assign(r.__assign({},e.docClassifications),(_={},_[p.fileId]=p.docClassification,_))});case n.Actions.PageDown:return void 0===(C=e.currentPageIndex)?e:r.__assign(r.__assign({},e),{currentPageIndex:C+1});case n.Actions.PageUp:var C;return void 0===(C=e.currentPageIndex)?e:r.__assign(r.__assign({},e),{currentPageIndex:C-1});case n.Actions.RegisterUser:p=a.payload;return r.__assign(r.__assign({},e),{currentUser:p.user});case n.Actions.SetTrialMode:p=a.payload;return r.__assign(r.__assign({},e),{isTrialMode:p.isTrialMode});case n.Actions.OverflowZoomOn:return r.__assign(r.__assign({},e),{overflowZoom:!0});case n.Actions.OverflowZoomOff:return r.__assign(r.__assign({},e),{overflowZoom:!1});default:return e}}})),define("modules/clean/react/file_viewer/data/selectors",["require","exports","tslib","modules/clean/redux/namespaces","modules/clean/redux/selectors","modules/clean/file_store/selectors","modules/clean/previews/data/selectors","modules/clean/react/file_viewer/constants","modules/clean/previews/data/preview_type_util","reselect","lodash","modules/clean/react/extensions/data/selectors","modules/clean/react/extensions/client","file-viewer/core/index"],(function(e,t,r,n,a,i,o,s,c,u,l,d,m,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDocClassificationForFile=t.getHelloSignAppActionForFile=t.isOverflowZoomMode=t.getExtensionsEnabled=t.shouldForceHideToolbar=t.getIsFlippingEnabled=t.getPreviewApiDataForCurrentFile=t.getPauseCount=t.getIsMediaPlaying=t.getRenderStatusForCurrentFile=t.getActiveUserBrandingInfo=t.getSelectedPromptCampaign=t.getShowOverQuotaUpsell=t.getActiveFile=t.getPageDimensions=t.getIsMarkupMode=t.getIsWatermarkingMode=t.getIsEditMode=t.getIsTrialMode=t.getAnnotationAllowed=t.getSidebar=t.getDisabledModes=t.getMode=t.getCurrentUser=t.getPastFile=t.getCurrentFile=t.getCurrentFileId=t.getAppDownloadInterstitial=t.getCurrentPageIndex=t.getIsSidebarOpen=t.getIsFullScreen=t.getFileViewerState=void 0,l=r.__importStar(l),t.getFileViewerState=function(e){return a.getStateAtNamespace(e,n.FILE_VIEWER_NAMESPACE_KEY)},t.getIsFullScreen=function(e){return t.getFileViewerState(e).isFullScreen},t.getIsSidebarOpen=function(e){return t.getFileViewerState(e).isSidebarOpen},t.getCurrentPageIndex=function(e){return t.getFileViewerState(e).currentPageIndex},t.getAppDownloadInterstitial=function(e){return t.getFileViewerState(e).appDownloadInterstitialDismissed},t.getCurrentFileId=function(e){return t.getFileViewerState(e).currentFileId},t.getCurrentFile=u.createSelector(l.nthArg(0),t.getCurrentFileId,i.getFile),t.getPastFile=function(e){return t.getFileViewerState(e).fileRevision},t.getCurrentUser=function(e){return t.getFileViewerState(e).currentUser},t.getMode=function(e){return t.getFileViewerState(e).mode},t.getDisabledModes=function(e){return t.getFileViewerState(e).disabledModes},t.getSidebar=function(e){return t.getFileViewerState(e).sidebar},t.getAnnotationAllowed=u.createSelector(t.getMode,(function(e){return e===g.FileViewerMode.Commenting})),t.getIsTrialMode=function(e){return t.getFileViewerState(e).isTrialMode},t.getIsEditMode=function(e){return t.getIsMarkupMode(e)||t.getIsWatermarkingMode(e)},t.getIsWatermarkingMode=function(e){return t.getMode(e)===g.FileViewerMode.Watermarking},t.getIsMarkupMode=function(e){return t.getMode(e)===g.FileViewerMode.Markup},t.getPageDimensions=function(e){return t.getFileViewerState(e).pageDimensions},t.getActiveFile=function(e){return t.getPastFile(e)||t.getCurrentFile(e)},t.getShowOverQuotaUpsell=function(e){return t.getFileViewerState(e).showOverQuotaUpsell};t.getSelectedPromptCampaign=function(e){return t.getFileViewerState(e).campaign},t.getActiveUserBrandingInfo=function(e){return t.getFileViewerState(e).activeUserBrandingInfo},t.getRenderStatusForCurrentFile=function(e){var r=t.getCurrentFileId(e);if(r)return(function(e,r){return t.getFileViewerState(e).renderStatuses[r]})(e,r)},t.getIsMediaPlaying=function(e){return t.getFileViewerState(e).isMediaPlaying},t.getPauseCount=function(e){var r=t.getFileViewerState(e).pauseCount;return r||0},t.getPreviewApiDataForCurrentFile=function(e){var r=t.getCurrentFile(e);return o.getApiDataForFile(e,r).data},t.getIsFlippingEnabled=function(e){var r=t.getPreviewApiDataForCurrentFile(e);return!(t.getIsEditMode(e)||t.getIsMediaPlaying(e)||t.getIsFullScreen(e)&&c.isSsrDoc(r))},t.shouldForceHideToolbar=function(e){return t.getFileViewerState(e).forceHideToolbar},t.getExtensionsEnabled=function(e){var r=t.getActiveFile(e);return!r||!d.fileExtensionsConfigs(e)[r.file_id]||d.fileExtensionsConfigs(e)[r.file_id].displayState!==m.DisplayState.DISABLED},t.isOverflowZoomMode=function(e){return!0===t.getFileViewerState(e).overflowZoom},t.getHelloSignAppActionForFile=function(e,t){return d.getShareActionsForFile(e,t).filter((function(e){return e.app_id===s.HELLOSIGN_PROD_APP_ID}))[0]},t.getDocClassificationForFile=function(e,r){var n=t.getFileViewerState(e);if(n&&n.docClassifications&&n.docClassifications[r])return n.docClassifications[r]}})),define("modules/clean/react/file_viewer/data/store",["require","exports","modules/clean/redux/store","modules/clean/redux/namespaces","modules/clean/file_store/reducer","modules/clean/react/file_viewer/data/reducer","modules/clean/previews/data/reducer","modules/clean/previews/data/actions","modules/clean/file_store/actions","modules/clean/react/file_viewer/data/actions","modules/clean/react/extensions/data/store"],(function(e,t,r,n,a,i,o,s,c,u,l){"use strict";var d;Object.defineProperty(t,"__esModule",{value:!0}),t.updateFileStore=t.hydrateFileStore=t.hydrateFileViewerNamespace=t.getStoreForFileViewer=t.fileViewerReducerMap=void 0,t.fileViewerReducerMap=((d={})[n.FILE_NAMESPACE_KEY]=a.fileNamespaceReducer,d[n.FILE_VIEWER_NAMESPACE_KEY]=i.fileViewerReducer,d[n.PREVIEW_NAMESPACE_KEY]=o.reducer,d),t.getStoreForFileViewer=function(){return l.getStore(),r.getStoreAndRegisterReducers(t.fileViewerReducerMap)},t.hydrateFileViewerNamespace=function(e,t,r){var n=t.file;n&&e.dispatch(u.openFile(n)),r&&e.dispatch(u.registerUser(r))},t.hydrateFileStore=function(e,t){e.dispatch(s.populateFilesPreviewData(t)),e.dispatch(c.putFiles(t))},t.updateFileStore=function(e,t){e.dispatch(c.putFiles(t))}})),define("modules/clean/react/file_viewer/data/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Actions=void 0,(function(e){e.CloseFile="FileViewer/CloseFile",e.CloseFullScreen="FileViewer/CloseFullScreen",e.CloseSidebar="FileViewer/CloseSidebar",e.DismissAppDownloadInterstitial="FileViewer/DismissAppDownloadInterstitial",e.DisableForceHideToolbar="FileViewer/DisableForceHideToolbar",e.ForceHideToolbar="FileViewer/ForceHideToolbar",e.UpdateMode="FileViewer/UpdateMode",e.DisableMode="FileViewer/DisableMode",e.EnableMode="FileViewer/EnableMode",e.OpenFile="FileViewer/OpenFile",e.OpenFullScreen="FileViewer/OpenFullScreen",e.OpenSidebar="FileViewer/OpenSidebar",e.PageDown="FileViewer/PageDown",e.PageUp="FileViewer/PageUp",e.PauseMedia="FileViewer/PauseMedia",e.PlayMedia="FileViewer/PlayMedia",e.PopSidebarPane="FileViewer/PopSidebarPane",e.PushSidebarPane="FileViewer/PushSidebarPane",e.SetSelectedSidebarControlId="FileViewer/SetSelectedSidebarControlId",e.ResetSidebarPaneStack="FileViewer/ResetSidebarPaneStack",e.ResetSelectedSidebarControlId="FileViewer/ResetSelectedSidebarControlId",e.ResetStore="FileViewer/ResetStore",e.UpdateCurrentPageIndex="FileViewer/UpdateCurrentPageIndex",e.RestoreRevision="FileViewer/RestoreRevision",e.SaveForwardRevision="FileViewer/SaveForwardRevision",e.SetCurrentCalloutType="FileViewer/SetCurrentCalloutType",e.SetShowOverQuotaUpsell="FileViewer/SetShowOverQuotaUpsell",e.SetSidebarVisibility="FileViewer/SetSidebarVisibility",e.SetPageDimensions="FileViewer/SetPageDimensions",e.UpdateWatermarkOptions="FileViewer/UpdateWatermarkOptions",e.SwitchWatermarkingMode="FileViewer/SwitchWatermarkingMode",e.SetMarkupCanvas="FileViewer/SetMarkupCanvas",e.UpdateMarkupCanvasScale="FileViewer/UpdateMarkupCanvasScale",e.ResetMarkupState="FileViewer/ResetMarkupState",e.SetMarkupDrawingMode="FileViewer/SetMarkupDrawingMode",e.SetMarkupFill="FileViewer/SetMarkupFill",e.SetMarkupStroke="FileViewer/SetMarkupStroke",e.SetMarkupSubmenuType="FileViewer/SetMarkupSubmenuType",e.SwitchRevision="FileViewer/SwitchRevision",e.UpdateRenderStatus="FileViewer/UpdateRenderStatus",e.RegisterUser="FileViewer/RegisterUser",e.SetTrialMode="FileViewer/SetTrialMode",e.FetchControllerModeRequest="FileViewer/FetchControllerModeRequest",e.FetchControllerModeSuccess="FileViewer/FetchControllerModeSuccess",e.FetchControllerModeError="FileViewer/FetchControllerModeError",e.FetchBestCampaign="FileViewer/FetchBestCampaign",e.SetBestCampaign="FileViewer/SetBestCampaign",e.SetActiveUserBrandingInfo="FileViewer/SetActiveUserBrandingInfo",e.SetDocClassification="FileViewer/SetDocClassification",e.OverflowZoomOn="FileViewer/OverflowZoomOn",e.OverflowZoomOff="FileViewer/OverflowZoomOff"})(t.Actions||(t.Actions={}))})),define("modules/clean/react/file_viewer/data/utils",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isUserOwnerOfFile=void 0,t.isUserOwnerOfFile=function(e,t){return e&&t&&e.home_ns_id===t.ns_id}})),define("modules/clean/react/file_viewer/open_button/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenButtonAction=void 0,(function(e){e[e.DOWNLOAD=0]="DOWNLOAD",e[e.UNITY_FILE=1]="UNITY_FILE",e[e.UNITY_FOLDER=2]="UNITY_FOLDER",e[e.OPEN_WITH=3]="OPEN_WITH",e[e.OPEN_IN_PAPER=4]="OPEN_IN_PAPER",e[e.APP_ACTION=5]="APP_ACTION",e[e.PREPARE_FOR_SIGNATURE=6]="PREPARE_FOR_SIGNATURE",e[e.SHARE_TO_SLACK=7]="SHARE_TO_SLACK",e[e.PRESENT_IN_ZOOM=8]="PRESENT_IN_ZOOM",e[e.SHARE_TO_TRELLO=9]="SHARE_TO_TRELLO",e[e.INVITE_VIA_EMAIL=10]="INVITE_VIA_EMAIL",e[e.OPEN_WITH_CLOUD_DOC=11]="OPEN_WITH_CLOUD_DOC",e[e.OPEN_MORE_APPS=12]="OPEN_MORE_APPS",e[e.OPEN_ADD_APPS=13]="OPEN_ADD_APPS",e[e.DECOMPRESS_FILE=14]="DECOMPRESS_FILE",e[e.PREVIEW_FILE=15]="PREVIEW_FILE",e[e.TRANSFER=16]="TRANSFER"})(t.OpenButtonAction||(t.OpenButtonAction={}))})),define("modules/clean/react/file_viewer/prompt/campaign_api",["require","exports","modules/clean/api_v2/user_client"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchBestCampaigns=void 0,t.fetchBestCampaigns=function(e,t){var n={client_context:{platform:"web",locations:["targeted_bubble"],ref_page:["preview","file_viewer"],display_context:"fv_preview_type="+t}};return(new r.UserApiV2Client).ns("prompt").rpc("get_best_campaigns",n,{subjectUserId:e})}})),define("modules/clean/react/location/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Location=void 0;var r=(function(){function e(e,t){void 0===t&&(t={}),this.path=e,this.query=t}return e.fromURI=function(t){return new e(t.getPath(),t.getQuery())},e})();t.Location=r})),define("modules/clean/react/size_class/size_class",["require","exports","tslib","react","classnames","hoist-non-react-statics","spectrum/match","modules/clean/react/size_class/constants","modules/clean/react/helpers"],(function(e,t,r,n,a,i,o,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.withSizeClass=t.SizeClass=void 0,n=r.__importDefault(n),a=r.__importDefault(a),i=r.__importDefault(i),Object.defineProperty(t,"SizeClass",{enumerable:!0,get:function(){return s.SizeClass}}),t.withSizeClass=function(e,t){void 0===t&&(t={});var u=(function(i){function u(t){var r=i.call(this,t)||this;return r.displayName="WithSizeClass("+c.getDisplayName(e),r.onMatchSmall=function(){return r.setState({sizeClass:s.SizeClass.Small})},r.onMatchMedium=function(){return r.setState({sizeClass:s.SizeClass.Medium})},r.onMatchLarge=function(){return r.setState({sizeClass:s.SizeClass.Large})},r.onMatchExtraLarge=function(){return r.setState({sizeClass:s.SizeClass.ExtraLarge})},window.matchMedia(s.MEDIA_SIZE_CLASS_EXTRA_LARGE).matches?r.state={sizeClass:s.SizeClass.ExtraLarge}:window.matchMedia(s.MEDIA_SIZE_CLASS_LARGE).matches?r.state={sizeClass:s.SizeClass.Large}:window.matchMedia(s.MEDIA_SIZE_CLASS_MEDIUM).matches?r.state={sizeClass:s.SizeClass.Medium}:r.state={sizeClass:s.SizeClass.Small},r}return r.__extends(u,i),u.prototype.render=function(){var i,c=t.isResponsiveEnabled,u=t.responsiveClassName,l=void 0===u?"":u,d=!c||c();return n.default.createElement("div",{className:a.default((i={},i[l]=d,i))},n.default.createElement(o.Match,{media:s.MEDIA_SIZE_CLASS_SMALL,onMatch:this.onMatchSmall}),n.default.createElement(o.Match,{media:s.MEDIA_SIZE_CLASS_MEDIUM,onMatch:this.onMatchMedium}),n.default.createElement(o.Match,{media:s.MEDIA_SIZE_CLASS_LARGE,onMatch:this.onMatchLarge}),n.default.createElement(o.Match,{media:s.MEDIA_SIZE_CLASS_EXTRA_LARGE,onMatch:this.onMatchExtraLarge}),n.default.createElement(e,r.__assign({},this.props,{sizeClass:d?this.state.sizeClass:s.SizeClass.Large})))},u})(n.default.Component);return i.default(u,e)}})),define("modules/clean/react/size_class/utils",["require","exports","modules/clean/react/size_class/constants"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSmallerThanLarge=void 0,t.isSmallerThanLarge=function(e){return e!==r.SizeClass.Large&&e!==r.SizeClass.ExtraLarge}})),define("modules/clean/react/watermarking/drawing",["require","exports"],(function(e,t){"use strict";function r(e,t,r,n,a){void 0===a&&(a=!1),e.save(),e.font=r+"px "+n;var i=e.measureText(t);return e.restore(),a?{width:i.width,height:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent||r}:{width:i.width,height:i.fontBoundingBoxAscent+i.fontBoundingBoxDescent||r}}Object.defineProperty(t,"__esModule",{value:!0}),t.drawImageTile=t.drawTextTile=void 0,t.drawTextTile=function(e,t,n,a,i,o){var s=document.createElement("canvas"),c=s.getContext("2d");if(!c)throw new Error("Cannot draw on canvas");var u=r(c,e,t,n),l=u.width,d=u.height;s.width=Math.abs(l*Math.cos(o))+Math.abs(d*Math.sin(o)),s.height=Math.abs(l*Math.sin(o))+Math.abs(d*Math.cos(o)),c.font=t+"px "+n,c.globalAlpha=i,c.fillStyle=a,c.textBaseline="bottom";var m=0,g=s.height;o<.5*Math.PI?m=d*Math.sin(o):o<Math.PI?(m=d*Math.sin(o)-l*Math.cos(o),g+=d*Math.cos(o)):o<1.5*Math.PI?(m=-l*Math.cos(o),g=0):g+=l*Math.sin(o),c.translate(m,g),c.rotate(-o),c.fillText(e,0,0);var _=r(c,e,t,n,!0),p=_.width;return{canvas:s,actualUnrotatedHeight:_.height,actualUnrotatedWidth:p}},t.drawImageTile=function(e,t,r,n){var a=document.createElement("canvas"),i=a.getContext("2d");if(!i)throw new Error("Cannot draw on canvas");var o=n||0,s=e.width*t,c=e.height*t;a.width=Math.round(Math.abs(s*Math.cos(o))+Math.abs(c*Math.sin(o))),a.height=Math.round(Math.abs(s*Math.sin(o))+Math.abs(c*Math.cos(o)));var u=0,l=0;return o<.5*Math.PI?l=s*Math.sin(o):o<Math.PI?(u=-s*Math.cos(o),l=s*Math.sin(o)-c*Math.cos(o)):o<1.5*Math.PI?(u=-s*Math.cos(o)-c*Math.sin(o),l=-c*Math.cos(o)):u=-c*Math.sin(o),i.globalAlpha=r,i.translate(u,l),i.rotate(-o),i.drawImage(e,0,0,s,c),{canvas:a,actualUnrotatedHeight:c,actualUnrotatedWidth:s}}})),define("modules/clean/react/watermarking/selectors",["require","exports","tslib","reselect","lodash","modules/clean/react/watermarking/types","modules/clean/react/watermarking/utils","modules/clean/react/watermarking/drawing","modules/clean/react/file_viewer/data/selectors"],(function(e,t,r,n,a,i,o,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWatermarkTilingFunc=t.getWatermarkState=void 0,a=r.__importStar(a),t.getWatermarkState=function(e){return c.getFileViewerState(e).watermark},t.getWatermarkTilingFunc=n.createSelector(t.getWatermarkState,(function(e){return a.memoize((function(t){var r=i.getWatermarkingOptions(e),n=r.angle,a=r.opacity,c=r.size,u=n%360,l=n/180*Math.PI,d=l%(Math.PI/2),m=(function(r){if(e.mode===i.WatermarkingMode.TEXT){var n=e.textWatermarkingOptions,u=n.color,l=n.fontFamily,d=n.text;return s.drawTextTile(d,c*t,l,u,a/100,r)}var m=e.imageWatermarkingOptions.image;if(!m)throw new o.WatermarkingError(o.WatermarkingError.TILE_NO_INPUT);return s.drawImageTile(m,c*t,a/100,r)})(l),g=m.canvas,_=m.actualUnrotatedHeight,p=m.actualUnrotatedWidth,f=Math.max(_,p),h=f/2,v=f/2;e.mode===i.WatermarkingMode.TEXT&&(h=2*_,v=e.textWatermarkingOptions.lineHeight*_);var S=p+h,b=_+v,y=0,w=0,A=0;return u%180==0?(y=S,w=b,A=h/-1.2):u%180==90?(y=b,w=S):u>0&&u<90||u>180&&u<270?(y=b/Math.sin(d),w=S*Math.sin(d),A=-S*Math.cos(d)):(u>90&&u<180||u>270&&u<360)&&(y=b/Math.cos(d),w=S*Math.cos(d),A=S*Math.sin(d)),{canvas:g,width:g.width,height:g.height,distanceX:y,distanceY:w,startX:-g.width/2,startY:-g.height/2,offsetXPerRow:A,offsetYPerCol:0}}))}))})),define("modules/clean/react/watermarking/types",["require","exports"],(function(e,t){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.getWatermarkingOptions=t.WatermarkPosition=t.WatermarkingMode=void 0,(function(e){e.TEXT="text",e.IMAGE="image"})(r=t.WatermarkingMode||(t.WatermarkingMode={})),(function(e){e.REPEAT="REPEAT",e.CENTER="CENTER",e.NORTHWEST="NORTHWEST",e.NORTHEAST="NORTHEAST",e.SOUTHEAST="SOUTHEAST",e.SOUTHWEST="SOUTHWEST"})(t.WatermarkPosition||(t.WatermarkPosition={})),t.getWatermarkingOptions=function(e){return e.mode===r.TEXT?e.textWatermarkingOptions:e.imageWatermarkingOptions}})),define("modules/clean/react/watermarking/utils",["require","exports","tslib","sjcl","lodash","modules/constants/file_viewer","modules/clean/i18n/formatters","modules/constants/page_load","modules/clean/file_store/utils","modules/core/i18n","modules/clean/previews/constants","modules/clean/react/watermarking/drawing","modules/clean/react/watermarking/types","modules/core/persistence/storage","modules/core/cookies","modules/core/exception","modules/clean/react/user_metadata/api"],(function(e,t,r,n,a,i,o,s,c,u,l,d,m,g,_,p,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isUnauthorizedAccessError=t.isUnsupportedFileError=t.isFilesystemError=t.isOverQuotaError=t.setUserMetadataTextWatermarkingState=t.getUserMetadataTextWatermarkingState=t.getLocalStorageWatermarkingState=t.setLocalStorageWatermarkingState=t.getWatermarkMilestone=t.getImageFromURL=t.getWatermarkingLabelText=t.getWatermarkScale=t.DEFAULT_WATERMARKING_STATE=t.getImageDefaultSizes=t.getDefaultText=t.allowWatermarkOrTrial=t.allowWatermarkTrial=t.getWatermarkTrialVariant=t.allowWatermark=t.isWatermarkingEnabled=t.fileIsWatermarkable=t.WatermarkingError=t.WATERMARKING_LOCAL_STORAGE_KEY=t.DEFAULT_SIZES=void 0,n=r.__importStar(n),a=r.__importStar(a),p=r.__importStar(p);var h=[".pdf",".jpg",".jpeg",".png",".bmp"];t.DEFAULT_SIZES={size:1,minSize:.2,maxSize:5},t.WATERMARKING_LOCAL_STORAGE_KEY="fileviewer_watermarking_data";var v=(function(e){function t(t){var r=e.call(this,t)||this;return r.message=t,r.name="WatermarkingError",r}return r.__extends(t,e),t.TILE_NO_INPUT="Unable to tile: missing text or image",t})(Error);function S(e){return e&&i.WATERMARK_TRIAL_VARIANT_BY_USER_ID?i.WATERMARK_TRIAL_VARIANT_BY_USER_ID[e.id]:""}function b(e){return!t.isWatermarkingEnabled(e)&&["DEACTIVATED_MENU","POPOVER_WM_VALUE_PROPS","POPOVER_PRO_VALUE_PROPS","TOOLTIP_ON_HOVER"].includes(S(e))}function y(e){return new Promise((function(t,r){var n=new Image;n.onload=function(){t(n)},n.onerror=function(e){r(e)},n.crossOrigin="anonymous",n.src=e}))}function w(e,r){var a=(function(e){try{var t=n.codec.utf8String.toBits(_.Cookies.read("__Host-js_csrf"));return n.encrypt(t,JSON.stringify(e))}catch(e){return void p.reportException({err:e,severity:p.SEVERITY.NONCRITICAL,tags:["watermarking"]})}})(r);a&&g.UserLocalStorage.set(e.id,t.WATERMARKING_LOCAL_STORAGE_KEY,a)}t.WatermarkingError=v,t.fileIsWatermarkable=function(e){return!!e&&(c.isBrowseFile(e)&&!e.read_only&&!!e.ext&&h.includes(e.ext.toLowerCase()))},t.isWatermarkingEnabled=function(e){return!!(e&&i.WATERMARKING_BY_USER_ID&&i.WATERMARKING_BY_USER_ID[e.id])},t.allowWatermark=function(e,r){return t.isWatermarkingEnabled(r)&&t.fileIsWatermarkable(e)},t.getWatermarkTrialVariant=S,t.allowWatermarkTrial=b,t.allowWatermarkOrTrial=function(e,r){return t.allowWatermark(e,r)||b(r)},t.getDefaultText=function(e){if(!e)return"DRAFT";var t=(0,o.createFormatters(s.USER_LOCALE,{}).formatDate)(new Date,{});return e.display_name+" | "+t},t.getImageDefaultSizes=function(e,r){if(!e||!r)return t.DEFAULT_SIZES;var n=e.width/r.width,a=e.height/r.height,i=Math.max(n,a);if(i*t.DEFAULT_SIZES.maxSize<=.9)return t.DEFAULT_SIZES;var o=.9/i;return{size:o/5,minSize:o/25,maxSize:o}},t.DEFAULT_WATERMARKING_STATE={mode:m.WatermarkingMode.TEXT,textWatermarkingOptions:{angle:45,color:"black",opacity:30,fontFamily:"Helvetica, sans-serif",size:20,minSize:5,maxSize:200,lineHeight:3,text:"DRAFT",position:m.WatermarkPosition.REPEAT,marginX:40,marginY:40,scale:1},imageWatermarkingOptions:r.__assign({angle:45,opacity:30,position:m.WatermarkPosition.REPEAT,marginX:40,marginY:40,scale:1},t.DEFAULT_SIZES)},t.getWatermarkScale=function(e){return e===l.PreviewType.SsrDoc?300/72:1},t.getWatermarkingLabelText=function(e,t){if(e)return t===l.PreviewType.Image?u.intl.formatMessage({id:"35NidE",defaultMessage:"Watermarking is available on PDFs, PNGs, JPEGs, and BMPs."}):u.intl.formatMessage({id:"HcLjiD",defaultMessage:"Watermarking is available on PDFs and images."})},t.getImageFromURL=y,t.getWatermarkMilestone=function(e){return"M2"},t.setLocalStorageWatermarkingState=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(a){if(!e||!t)return[2];n=(function(e){var t=r.__assign(r.__assign({},e),{imageWatermarkingOptions:r.__assign({},e.imageWatermarkingOptions)});t.imageWatermarkingOptions.image&&!t.imageWatermarkingOptions.imageAsDataURL&&(t.imageWatermarkingOptions.imageAsDataURL=d.drawImageTile(t.imageWatermarkingOptions.image,1,1).canvas.toDataURL());return delete t.imageWatermarkingOptions.image,t})(t);try{w(e,n)}catch(t){if(n.imageWatermarkingOptions.imageAsDataURL){delete n.imageWatermarkingOptions.imageAsDataURL;try{w(e,n)}catch(e){p.reportException({err:t,severity:p.SEVERITY.NONCRITICAL,tags:["watermarking"]})}}}return[2]}))}))},t.getLocalStorageWatermarkingState=function(e){return r.__awaiter(this,void 0,void 0,(function(){var a,i,o,s,c;return r.__generator(this,(function(r){switch(r.label){case 0:if(!(a=g.UserLocalStorage.get(e.id,t.WATERMARKING_LOCAL_STORAGE_KEY)))return[3,5];r.label=1;case 1:return r.trys.push([1,4,,5]),i=n.codec.utf8String.toBits(_.Cookies.read("__Host-js_csrf")),(o=JSON.parse(n.decrypt(i,a))).imageWatermarkingOptions.imageAsDataURL?(s=o.imageWatermarkingOptions,[4,y(o.imageWatermarkingOptions.imageAsDataURL)]):[3,3];case 2:s.image=r.sent(),r.label=3;case 3:return[2,o];case 4:return c=r.sent(),p.reportException({err:c,severity:p.SEVERITY.NONCRITICAL,tags:["watermarking"]}),[3,5];case 5:return[2]}}))}))},t.getUserMetadataTextWatermarkingState=function(e){return r.__awaiter(this,void 0,Promise,(function(){var t,n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,f.getUserMetadata(["TEXT_WATERMARKING_COLOR","TEXT_WATERMARKING_TEXT","TEXT_WATERMARKING_OPACITY","TEXT_WATERMARKING_ANGLE","TEXT_WATERMARKING_POSITION","TEXT_WATERMARKING_SIZE"],e.id)];case 1:return t=r.sent(),n={color:t.TEXT_WATERMARKING_COLOR?t.TEXT_WATERMARKING_COLOR:void 0,text:t.TEXT_WATERMARKING_TEXT,opacity:t.TEXT_WATERMARKING_OPACITY,angle:t.TEXT_WATERMARKING_ANGLE,position:t.TEXT_WATERMARKING_POSITION?t.TEXT_WATERMARKING_POSITION:void 0,size:t.TEXT_WATERMARKING_SIZE},[2,a.omitBy(n,a.isUndefined)];case 2:return i=r.sent(),p.reportException({err:i,severity:p.SEVERITY.NONCRITICAL,tags:["watermarking"]}),[2];case 3:return[2]}}))}))},t.setUserMetadataTextWatermarkingState=function(e,t){var r=t.textWatermarkingOptions;f.setUserMetadata({TEXT_WATERMARKING_COLOR:r.color,TEXT_WATERMARKING_TEXT:r.text,TEXT_WATERMARKING_OPACITY:r.opacity,TEXT_WATERMARKING_ANGLE:r.angle,TEXT_WATERMARKING_POSITION:r.position,TEXT_WATERMARKING_SIZE:r.size},e.id)},t.isOverQuotaError=function(e){return!(!e||"over_quota_error"!==e[".tag"])},t.isFilesystemError=function(e){return!(!e||"filesystem_error"!==e[".tag"])},t.isUnsupportedFileError=function(e){return!(!e||"unsupported_file_error"!==e[".tag"])},t.isUnauthorizedAccessError=function(e){return!(!e||"unauthorized_access"!==e[".tag"])}})),define("modules/clean/react/workflows/markup/fabric_wrapper",["require","exports","tslib","fabric"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fabric=void 0;var a=(n=r.__importDefault(n)).default.fabric||n.default;t.fabric=a})),define("modules/clean/react/workflows/markup/fabric",["require","exports","tslib","modules/clean/react/workflows/markup/fabric_wrapper","modules/clean/previews/constants","modules/clean/react/workflows/markup/types","modules/clean/api_v2/user_client"],(function(e,t,r,n,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFill=t.getStroke=t.setOptionsForActiveObjects=t.saveMarkup=t.disposeCanvas=t.setBaseBrushColor=t.setDrawingMode=t.addMarkupObject=void 0;n.fabric.Object&&(n.fabric.util.object.extend(n.fabric.Object.prototype,{cornerStyle:"circle",cornerColor:"#0052D9",cornerSize:10,cornerStrokeColor:"white",transparentCorners:!1,drawControls:function(e,t){t=t||{};var r=this._calculateCurrentDimensions(),n=r.x,a=r.y,i=t.cornerSize||this.cornerSize,o=-(n+i)/2,s=-(a+i)/2,c=void 0!==t.transparentCorners?t.transparentCorners:this.transparentCorners,u=void 0!==t.hasRotatingPoint?t.hasRotatingPoint:this.hasRotatingPoint,l=c?"stroke":"fill";return e.save(),e.strokeStyle=e.fillStyle=t.cornerColor||this.cornerColor,this.transparentCorners||(e.strokeStyle=t.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(e,t.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",e,l,o,s,t),this._drawControl("tr",e,l,o+n,s,t),this._drawControl("bl",e,l,o,s+a,t),this._drawControl("br",e,l,o+n,s+a,t),u&&this._drawControl("mtr",e,l,o+n/2,s-this.rotatingPointOffset,t),e.restore(),this},_findTargetCorner:function(e){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var t=e.x,r=e.y;for(var n in this.__corner=0,this.oCoords)if(this.isControlVisible(n)&&("mtr"!==n||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==n&&"mr"!==n&&"mb"!==n&&"ml"!==n)){var a=void 0;switch(n){case"mt":a=this._getHorizontalImageLines(this.oCoords.tl.corner,this.oCoords.tr.corner);break;case"mr":a=this._getVerticalImageLines(this.oCoords.tr.corner,this.oCoords.br.corner);break;case"mb":a=this._getHorizontalImageLines(this.oCoords.bl.corner,this.oCoords.br.corner);break;case"ml":a=this._getVerticalImageLines(this.oCoords.tl.corner,this.oCoords.bl.corner);break;default:a=this._getImageLines(this.oCoords[n].corner)}var i=this._findCrossPoints({x:t,y:r},a);if(0!==i&&i%2==1)return this.__corner=n,n}return!1},_getHorizontalImageLines:function(e,t){return{topline:{o:e.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_getVerticalImageLines:function(e,t){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:e.tl}}}}),n.fabric.util.object.extend(n.fabric.Canvas.prototype,{uniScaleKey:null,_getActionFromCorner:function(e,t,r){if(!t||!e)return"drag";switch(t){case"mtr":return"rotate";case"ml":case"mr":return r.shiftKey?"scale":"scaleX";case"mt":case"mb":return r.shiftKey?"scale":"scaleY";default:return"scale"}}})),n.fabric.BaseBrush&&(c(i.MarkupColor.RED_CHERRY),n.fabric.BaseBrush.prototype.width=3);var s={strokeUniform:!0,strokeWidth:3,stroke:"red"};function c(e){n.fabric.BaseBrush&&(n.fabric.BaseBrush.prototype.color=e)}function u(e){return e&&"group"===e.type}function l(e){return e&&"i-text"===e.type}t.addMarkupObject=function(e,t,a){var o;switch(t){case i.MarkupType.TEXT:o=new n.fabric.IText("Text",r.__assign(r.__assign(r.__assign(r.__assign({},s),{fontSize:22}),a),{fill:a.stroke,stroke:void 0}));break;case i.MarkupType.CIRCLE:o=new n.fabric.Circle(r.__assign(r.__assign(r.__assign({},s),{radius:50,fill:void 0}),a));break;case i.MarkupType.RECT:o=new n.fabric.Rect(r.__assign(r.__assign(r.__assign({},s),{width:100,height:100,fill:void 0}),a));break;case i.MarkupType.ARROW:var c=a.left,u=a.top,l=a.stroke,d=[c,u+100,c+100,u],m=180*Math.atan2(100,100)/Math.PI,g=new n.fabric.Triangle(r.__assign(r.__assign({},s),{angle:m,top:d[3],left:d[2]+3,height:15,width:15,originX:"center",originY:"center",stroke:l,fill:l})),_=new n.fabric.Line(d,r.__assign(r.__assign({},s),a));o=new n.fabric.Group([_,g],r.__assign(r.__assign(r.__assign({},s),{lockUniScaling:!0,centeredScaling:!0}),a))}o&&(e.add(o),e.setActiveObject(o))},t.setDrawingMode=function(e,t){for(var r in e)if(e.hasOwnProperty(r)&&"object"==typeof e[r]){var n=e[r].fabric;n&&(n.isDrawingMode=t)}},t.setBaseBrushColor=c,t.disposeCanvas=function(e){for(var t in e)e[t].fabric&&e[t].fabric.dispose()},t.saveMarkup=function(e,t,n,i,s){return r.__awaiter(this,void 0,void 0,(function(){var c,u,l,d,m,g,_,p,f,h,v,S;return r.__generator(this,(function(r){for(d in c=new o.UserApiV2Client,u=[],l=s===a.PreviewType.SsrDoc?300/72:1,i)if(i.hasOwnProperty(d)&&"object"==typeof i[d]&&(m=i[d].scale,g=l/m,_=i[d].fabric))for(p=0,f=_.getObjects();p<f.length;p++)h=f[p],v=h.getBoundingRect(),u.push({".tag":"burn_image",image:h.toDataURL({multiplier:g}).split(",",2).pop(),x:Math.round(v.left/m),y:Math.round(v.top/m),page:Number(d)});return S={path:t,should_overwrite:n,burn_objects:u},[2,c.ns("workflows").rpc("markup_file",S,{subjectUserId:e})]}))}))},t.setOptionsForActiveObjects=function(e,t){e&&(e.getActiveObjects().forEach((function(e){l(e)?e.set(r.__assign(r.__assign({},t),{stroke:void 0,fill:t.stroke||e.fill})):u(e)?e.forEachObject((function(e){return e.set(r.__assign(r.__assign({},t),{fill:t.stroke||e.stroke}))})):!(function(e){return e&&"path"===e.type})(e)?e.set(t):e.set(r.__assign(r.__assign({},t),{fill:void 0}))})),e.renderAll())},t.getStroke=function(e){return l(e)?e.fill:u(e)?e.getObjects().filter((function(e){return"line"===e.type}))[0].stroke:"stroke"in e?e.stroke:void 0},t.getFill=function(e){if((function(e){return e&&"circle"===e.type})(e)||(function(e){return e&&"rect"===e.type})(e))return e.fill}})),define("modules/clean/react/workflows/markup/selectors",["require","exports","modules/clean/react/file_viewer/data/selectors"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMarkupState=void 0,t.getMarkupState=function(e){return r.getFileViewerState(e).markup}})),define("modules/clean/react/workflows/markup/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MarkupColor=t.FormatSubmenuEntry=t.MarkupType=void 0,(function(e){e[e.TEXT=0]="TEXT",e[e.CIRCLE=1]="CIRCLE",e[e.RECT=2]="RECT",e[e.ARROW=3]="ARROW",e[e.FREEFORM=4]="FREEFORM"})(t.MarkupType||(t.MarkupType={})),(function(e){e.STROKE="stroke",e.FILL="fill"})(t.FormatSubmenuEntry||(t.FormatSubmenuEntry={})),(function(e){e.TRANSPARENT="transparent",e.RED_CHERRY="#D62C0B",e.ORANGE_TANGERINE="#FF8E21",e.GREEN="#00864C",e.DARK_BLUE="#005DD6",e.ULTRAVIOLET="#813BF6",e.WHITE="white",e.BLACK="black"})(t.MarkupColor||(t.MarkupColor={}))})),define("modules/clean/react/workflows/markup/utils",["require","exports","modules/constants/file_viewer","modules/clean/file_store/utils","modules/clean/previews/constants","modules/core/i18n","modules/clean/react/workflows/markup/types"],(function(e,t,r,n,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_MARKUP_STATE=t.getMarkupErrorMessage=t.getMarkupLabelText=t.allowMarkup=t.userCanMarkup=t.fileIsMarkupable=t.MOVE_DISTANCE_Y=t.MOVE_DISTANCE_X=t.DEFAULT_TOP=t.DEFAULT_LEFT=t.OFFSET=void 0;var s=[".pdf",".jpg",".jpeg",".png",".bmp"];t.OFFSET=10,t.DEFAULT_LEFT=100,t.DEFAULT_TOP=100,t.MOVE_DISTANCE_X=1,t.MOVE_DISTANCE_Y=1,t.fileIsMarkupable=function(e){return!!e&&(n.isBrowseFile(e)&&!e.read_only&&!!e.ext&&s.includes(e.ext.toLowerCase()))};t.userCanMarkup=function(){return["M0"].includes(r.FILE_MARKUP)},t.allowMarkup=function(e){return t.userCanMarkup()&&t.fileIsMarkupable(e)},t.getMarkupLabelText=function(e,t){if(e)return t===a.PreviewType.Image?i.intl.formatMessage({id:"4hf7s2",defaultMessage:"Markup is available on PDFs, PNGs, JPEGs, and BMPs."}):i.intl.formatMessage({id:"PSKrse",defaultMessage:"Markup is available on PDFs and images."})},t.getMarkupErrorMessage=function(e){switch(e[".tag"]){case"over_quota_error":return i.intl.formatMessage({id:"ebkvMX",defaultMessage:"Can’t save because your account is full. Upgrade to get more space."});case"filesystem_error":return i.intl.formatMessage({id:"rV+Py+",defaultMessage:"Couldn’t save markup. Refresh the page to try again."});case"unsupported_file_error":return i.intl.formatMessage({id:"9ZczZk",defaultMessage:"Can’t save. Markup isn’t available for this file type."});case"unauthorized_access":return i.intl.formatMessage({id:"+/+p5G",defaultMessage:"You don’t have permission to save to this folder."});default:return i.intl.formatMessage({id:"rV+Py+",defaultMessage:"Couldn’t save markup. Refresh the page to try again."})}},t.DEFAULT_MARKUP_STATE={isDrawingMode:!1,formatSubmenu:[],strokeColor:o.MarkupColor.RED_CHERRY,fillColor:o.MarkupColor.TRANSPARENT}})),define("modules/clean/react/user_metadata/api",["require","exports","modules/clean/api_v2/user_client","modules/clean/react/user_metadata/util"],(function(e,t,r,n){"use strict";function a(e){var t=n.removeEmptyFields(e),r=n.getUserMetadataKeys(t),a={};return r.forEach((function(e){a[e]=JSON.stringify(t[e])})),a}function i(e){var t=n.getUserMetadataKeys(e.metadata),r={};return t.forEach((function(t){var n=JSON.parse(e.metadata[t]);null!=n&&(r[t]=n)})),r}function o(e,t){return(new r.UserApiV2Client).ns("user_metadata").rpc("user_metadata/get",e,{subjectUserId:t})}function s(e,t){return(new r.UserApiV2Client).ns("user_metadata").rpc("user_metadata/set",e,{subjectUserId:t})}Object.defineProperty(t,"__esModule",{value:!0}),t.mutateUserMetadata=t.fetchUserMetadata=t.processUserMetadataResult=t.prepareUserMetadataSetArg=t.setUserMetadata=t.getUserMetadata=void 0,t.getUserMetadata=function(e,t){return o({metadata:e},t).then(i)},t.setUserMetadata=function(e,t){return s({metadata:a(e)},t).then(i)},t.prepareUserMetadataSetArg=a,t.processUserMetadataResult=i,t.fetchUserMetadata=o,t.mutateUserMetadata=s})),define("modules/clean/react/user_metadata/util",["require","exports"],(function(e,t){"use strict";function r(e){return Object.keys(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.getUserMetadataKeys=t.removeEmptyFields=void 0,t.removeEmptyFields=function(e){var t=r(e),n={};return t.forEach((function(t){null!=e[t]&&(n[t]=e[t])})),n},t.getUserMetadataKeys=r})),define("modules/clean/react/branding/api",["require","exports","tslib","modules/clean/react/premium_kit/api","modules/clean/react/premium_kit/types","modules/clean/react/user_metadata/api","modules/core/uri"],(function(e,t,r,n,a,i,o){"use strict";function s(e,t){var r=new o.URI({scheme:"https",authority:"www.dropbox.com",path:"/team/"+t+"/"+e,query:{suppress_default_logo:"1"}}).toString();return new Promise((function(e,n){var a=new XMLHttpRequest;a.open("HEAD",r),a.onload=function(){switch(a.status){case 200:return e(r);case 404:return e(void 0);default:throw new Error("Failed to get "+t)}},a.onerror=function(){return n(new Error("Failed to get "+t))},a.send()}))}Object.defineProperty(t,"__esModule",{value:!0}),t.getTeamBackgroundUrl=t.getTeamLogoUrl=t.DISALLOWED=t.saveName=t.getName=t.saveLogoFlag=t.removeLogo=t.getLogo=t.saveSelectedBackgroundAssetId=t.getSelectedBackgroundAssetId=t.getBackgroundAssets=t.USER_METADATA_BRANDING_LOGO_SET_KEY=t.USER_METADATA_BACKGROUND_KEY=t.USER_METADATA_ORG_NAME_KEY=void 0,t.USER_METADATA_ORG_NAME_KEY="PREMIUM_KIT_ORGANIZATION_NAME",t.USER_METADATA_BACKGROUND_KEY="PREMIUM_KIT_BACKGROUND_ASSET_ID",t.USER_METADATA_BRANDING_LOGO_SET_KEY="PREMIUM_KIT_BRANDING_LOGO_SET",t.getBackgroundAssets=function(e){var t,i;return r.__awaiter(this,void 0,Promise,(function(){var o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,n.getAssetLibraries(e,[a.AssetLibraryId.BrandingBackground])];case 1:return o=r.sent(),[2,(null===(i=null===(t=o.asset_libraries)||void 0===t?void 0:t[0])||void 0===i?void 0:i.assets)||[]]}}))}))},t.getSelectedBackgroundAssetId=function(e){return r.__awaiter(this,void 0,Promise,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i.getUserMetadata([t.USER_METADATA_BACKGROUND_KEY],e)];case 1:return[2,r.sent()[t.USER_METADATA_BACKGROUND_KEY]||""]}}))}))},t.saveSelectedBackgroundAssetId=function(e,n){return r.__awaiter(this,void 0,Promise,(function(){var a;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i.setUserMetadata((a={},a[t.USER_METADATA_BACKGROUND_KEY]=n||"",a),e)];case 1:return r.sent(),[2]}}))}))},t.getLogo=function(e){var t,i,o;return r.__awaiter(this,void 0,Promise,(function(){var s;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,n.getAssetLibraries(e,[a.AssetLibraryId.BrandingLogo])];case 1:return s=r.sent(),[2,null===(o=null===(i=null===(t=s.asset_libraries)||void 0===t?void 0:t[0])||void 0===i?void 0:i.assets)||void 0===o?void 0:o[0]]}}))}))},t.removeLogo=function(e){return r.__awaiter(this,void 0,Promise,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,n.removeAssetLibrary(e,a.AssetLibraryId.BrandingLogo)];case 1:return t.sent(),[2]}}))}))},t.saveLogoFlag=function(e,n){return r.__awaiter(this,void 0,Promise,(function(){var a;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i.setUserMetadata((a={},a[t.USER_METADATA_BRANDING_LOGO_SET_KEY]=n,a),e)];case 1:return r.sent(),[2]}}))}))},t.getName=function(e){return r.__awaiter(this,void 0,Promise,(function(){return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i.getUserMetadata([t.USER_METADATA_ORG_NAME_KEY],e)];case 1:return[2,r.sent()[t.USER_METADATA_ORG_NAME_KEY]||""]}}))}))},t.saveName=function(e,n){return r.__awaiter(this,void 0,Promise,(function(){var a;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,i.setUserMetadata((a={},a[t.USER_METADATA_ORG_NAME_KEY]=n,a),e)];case 1:return r.sent(),[2]}}))}))},t.DISALLOWED={disallowed:!0},t.getTeamLogoUrl=function(e){return r.__awaiter(this,void 0,Promise,(function(){return r.__generator(this,(function(t){return[2,s(e,"team_logo")]}))}))},t.getTeamBackgroundUrl=function(e){return r.__awaiter(this,void 0,Promise,(function(){return r.__generator(this,(function(t){return[2,s(e,"team_background")]}))}))}})),define("modules/clean/react/premium_kit/api",["require","exports","tslib","modules/clean/api_v2/user_client"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeAssetLibrary=t.getAssetLibraries=t.addAssetByBlock=void 0,t.addAssetByBlock=function(e,t,a,i){return r.__awaiter(this,void 0,Promise,(function(){var o;return r.__generator(this,(function(r){switch(r.label){case 0:if(0===a.length)throw new Error("blockTokens list must not be empty");return o={library_assets_to_add:[{asset_library_id:i,assets_to_add:[{asset_id:t,file_args:{".tag":"add_by_blocks",tokens:a}}]}]},[4,(new n.UserApiV2Client).ns("premium_kit").rpc("asset_libraries/add_assets",o,{subjectUserId:e}).then((function(e){var t,r=e.added_library_assets[0].added_assets[0].result;switch(r[".tag"]){case"asset":return(null===(t=null==r?void 0:r.graphic)||void 0===t?void 0:t.fallback_image_url)?r:void 0;case"asset_error":throw new Error(r.message);default:throw new Error("unexpected .tag value "+r[".tag"])}}))];case 1:return[2,r.sent()]}}))}))},t.getAssetLibraries=function(e,t){var r={asset_library_ids:t};return(new n.UserApiV2Client).ns("premium_kit").rpc("asset_libraries/get",r,{subjectUserId:e})},t.removeAssetLibrary=function(e,t){return r.__awaiter(this,void 0,Promise,(function(){var a;return r.__generator(this,(function(r){switch(r.label){case 0:return a={asset_library_id:t},[4,(new n.UserApiV2Client).ns("premium_kit").rpc("asset_libraries/remove",a,{subjectUserId:e})];case 1:return[2,r.sent()]}}))}))}})),define("modules/clean/react/premium_kit/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AssetType=t.AssetId=t.AssetLibraryId=void 0,(function(e){e.BrandingBackground="branding_background",e.BrandingLogo="branding_logo",e.CustomLogo="custom_logo"})(t.AssetLibraryId||(t.AssetLibraryId={})),(function(e){e.BrandingCustomBackground="branding_custom_background",e.BrandingLogo="branding_logo",e.CustomLogo="custom_logo",e.Sapphire="sapphire",e.PinkLibrary="pink_library",e.Wheat="wheat",e.BlackCherry="black_cherry",e.Canopy="canopy",e.Turquoise="turquoise",e.Topaz="topaz",e.Pollen="pollen",e.Azalea="azalea",e.Shark="shark",e.AbstractHands="abstract_hands",e.RedMan="red_man",e.TransferAnimals="transfer_animals",e.BlueStairs="blue_stairs",e.WAVE="wave"})(t.AssetId||(t.AssetId={})),(function(e){e.Image="image",e.Video="video",e.Color="color",e.Other="other"})(t.AssetType||(t.AssetType={}))})),define("modules/clean/react/previews/preview_toolbar_button",["require","exports","tslib","classnames","react","modules/clean/react/sprite","modules/clean/static_urls","spectrum/icon_document","spectrum/tooltip"],(function(e,t,r,n,a,i,o,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewToolbarButton=void 0,n=r.__importDefault(n),a=r.__importDefault(a),t.PreviewToolbarButton=function(e){var t=e.className,r=e["data-test"],u=e.disabled,l=e.iconName,d=e.onClick,m=e.spriteGroup,g=e.spriteName,_=e.spectrumIconName,p=e.tooltip;return a.default.createElement("div",{className:n.default(t,"toolbar-button-entry"),"data-test":r},a.default.createElement(c.Tooltip,{positioning:"above",positionOffset:24,tooltipContent:p},a.default.createElement("button",{className:t+"-button","aria-label":p,onClick:d},void 0!==l?a.default.createElement("img",{src:o.static_url("/static/images/previews/toolbar/"+l+".svg"),alt:p,className:n.default({disabled:u})}):void 0!==g?a.default.createElement(i.Sprite,{group:m,name:g,alt:p,className:n.default({disabled:u})}):a.default.createElement(s.IconDocument,{name:_}))))}})),define("spectrum/icon_document",["require","exports","tslib","react","spectrum/icon_templates/stateless","spectrum/svg_icon_bundle","spectrum/icon_document/bundle"],(function(e,t,r,n,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconDocument=t.ICONS=void 0,n=r.__importStar(n),Object.defineProperty(t,"ICONS",{enumerable:!0,get:function(){return o.ICONS}}),t.IconDocument=function(e){var t=e.name,r=n.createElement(i.SvgIconBundle,{focusable:"false",icon:o.ICONS[t]});return n.createElement(a.Component,Object.assign({icon:r},e))},t.IconDocument.displayName="IconDocument"})),define("spectrum/icon_document/bundle",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ICONS=void 0,t.ICONS=JSON.parse('\n    {"date-small":{"attrs":{"width":"24","height":"24","viewBox":"0 0 24 24"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#000\\" fill-rule=\\"nonzero\\"><path d=\\"M4 4h16v16H4V4zm2 2v12h12V6H6z\\"></path><path d=\\"M5 8h14v2H5zM7 2h2v4H7zM15 2h2v4h-2z\\"></path></g></g>"},"date":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#000\\" fill-rule=\\"nonzero\\"><path d=\\"M6 6h20v20H6V6zm2 2v16h16V8H8z\\"></path><path d=\\"M7 11h18v2H7zM11 4h2v4h-2zM19 4h2v4h-2z\\"></path></g></g>"},"signature-small":{"attrs":{"width":"24","height":"24","viewBox":"0 0 24 24"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#000\\" fill-rule=\\"nonzero\\"><path d=\\"M1 18h22v1H1z\\"></path><path d=\\"M10.874 17.262c-1.33 1.046-1.25 2.246-.297 2.723 1.076.537 2.438-.321 3.206-2.953.226-.774.42-1.509.583-2.205-1.06.632-2.251 1.46-3.492 2.435zm4.589.26c-1.044 3.578-3.487 5.118-5.668 4.028-2.131-1.065-2.317-3.844-.003-5.664 1.857-1.46 3.565-2.6 5.014-3.317.634-4.207-.218-6.501-2.436-6.681-1.374-.111-1.993.459-2.027 1.713-.041 1.48.799 3.57 2.34 5.61l-1.397 1.054c-1.76-2.33-2.746-4.782-2.693-6.713.062-2.246 1.534-3.602 3.918-3.408 3.355.272 4.634 3.065 4.144 7.711 1.236-.31 2.137-.102 2.578.742.211.404.28.842.24 1.308a3.4 3.4 0 0 1-.025.205c1.118-.989 1.885-1.388 2.896-1.103.22.063.432.163.632.299l-.986 1.446a.42.42 0 0 0-.121-.06c-.223-.063-.618.152-1.332.792l-.42.379c-.17.151-.308.267-.442.37-.42.32-.786.5-1.217.5-.758 0-1.248-.545-1.188-1.264a2.4 2.4 0 0 1 .12-.543c.034-.105.181-.524.157-.454.11-.32.166-.532.182-.719a.652.652 0 0 0-.037-.325c.02.04.003.044-.143.053-.287.018-.69.127-1.183.324a38.652 38.652 0 0 1-.903 3.717zM1.381 11.619L2.62 10.38l4.95 4.95-1.238 1.237z\\"></path><path d=\\"M6.377 10.382l1.238 1.236-4.948 4.952-1.238-1.237z\\"></path></g></g>"},"signature":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#000\\" fill-rule=\\"nonzero\\"><path d=\\"M3 24h26v1H3z\\"></path><path d=\\"M12.5 23.31c-1.983 1.56-1.857 3.437-.376 4.177 1.643.821 3.682-.464 4.79-4.26.37-1.271.68-2.47.931-3.594-1.6.917-3.43 2.172-5.345 3.678zm6.334.476c-1.423 4.878-4.698 6.942-7.604 5.49-2.828-1.413-3.075-5.094.034-7.538 2.627-2.065 5.04-3.666 7.065-4.65.94-6.089-.293-9.445-3.584-9.712-2.047-.166-3.02.73-3.072 2.607-.058 2.126 1.133 5.09 3.313 7.976l-1.595 1.206c-2.431-3.218-3.79-6.597-3.717-9.237.082-3.012 2.03-4.805 5.233-4.546 4.596.373 6.315 4.295 5.547 10.86 1.785-.52 3.073-.3 3.663.83.273.523.363 1.094.31 1.705a4.971 4.971 0 0 1-.175.925c.12-.105.252-.223.4-.356 1.565-1.402 2.605-1.969 3.947-1.59.285.08.558.21.818.387l-1.126 1.652a.807.807 0 0 0-.235-.114c-.414-.117-1.015.21-2.07 1.155-.07.063-.47.426-.586.529a10.64 10.64 0 0 1-.604.506c-.55.42-1.024.653-1.565.653-.928 0-1.51-.649-1.437-1.524.018-.219.07-.436.158-.71.046-.143.25-.725.217-.63.16-.462.24-.774.265-1.057.023-.255-.008-.449-.09-.605-.063-.122-.828-.083-2.231.498-.3 1.634-.728 3.4-1.279 5.29z\\"></path><path d=\\"M8.293 14.294l1.415 1.414-4.997 5-1.414-1.414z\\"></path><path d=\\"M3.297 15.708l1.414-1.414 5 5-1.414 1.414z\\"></path></g></g>"},"text-small":{"attrs":{"width":"24","height":"24","viewBox":"0 0 24 24"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#000\\" fill-rule=\\"nonzero\\"><path d=\\"M4 4h16v16H4V4zm2 2v12h12V6H6z\\"></path><path d=\\"M8 8h8v2H8z\\"></path><path d=\\"M11 9h2v7h-2z\\"></path></g></g>"},"text":{"attrs":{"width":"32","height":"32","viewBox":"0 0 32 32"},"dangerouslySetInnerIconHtml":"<g fill=\\"none\\" fill-rule=\\"evenodd\\"><g fill=\\"#000\\" fill-rule=\\"nonzero\\"><path d=\\"M6 6h20v20H6V6zm2 2v16h16V8H8z\\"></path><path d=\\"M11 11h10v2H11zM15 13h2v8h-2z\\"></path></g></g>"}}\n  ')}));
//# sourceMappingURL=pkg-shared_link_core.min.js-vflvD_edI.map